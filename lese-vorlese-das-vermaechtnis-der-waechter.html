<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Das Verm√§chtnis der W√§chter - Vorlesen</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d1810 50%, #0f0f23 100%);
            min-height: 100vh;
        }
        
        .rainbow-header {
            height: 20px;
            background: linear-gradient(90deg, 
                #FFD700 0%, 
                #FFA500 14%, 
                #FF8C00 28%, 
                #8B4513 42%, 
                #654321 56%, 
                #4B0000 70%, 
                #2F1B14 84%, 
                #1C1C1C 100%);
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            background: linear-gradient(135deg, #2a2a3a 0%, #1f1f2f 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 3px solid #FFD700;
        }
        
        .book-cover {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .book-cover img {
            max-width: 200px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.6);
            border: 3px solid #FFD700;
        }
        
        h1 {
            color: #FFD700;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255,215,0,0.5);
        }
        
        .author {
            text-align: center;
            color: #FFA500;
            font-style: italic;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .controls {
            position: sticky;
            top: 20px;
            text-align: center;
            margin: 30px 0 10px 0;
            padding: 20px;
            background: linear-gradient(135deg, #3a3a4a 0%, #2f2f3f 100%);
            border-radius: 15px;
            border: 2px solid #FFD700;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(255,215,0,0.3);
        }
        
        .language-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-lang {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            border: 2px solid transparent;
        }
        
        .btn-lang.active {
            border-color: #FF8C00;
            box-shadow: 0 0 15px rgba(255, 140, 0, 0.8);
        }
        
        .btn-lang:hover {
            background: linear-gradient(135deg, #FFA500, #FF8C00);
            transform: translateY(-2px);
        }
        
        .btn-nav {
            background: linear-gradient(135deg, #8B4513, #654321);
            color: white;
            text-decoration: none;
            border: 2px solid transparent;
        }
        
        .btn-nav:hover {
            background: linear-gradient(135deg, #654321, #4B0000);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139,69,19,0.4);
        }
        
        .btn-read {
            background: linear-gradient(135deg, #228B22, #006400);
            color: white;
        }
        
        .btn-read:hover {
            background: linear-gradient(135deg, #006400, #004000);
            transform: translateY(-2px);
        }
        
        .btn-stop {
            background: linear-gradient(135deg, #DC143C, #B22222);
            color: white;
        }
        
        .btn-stop:hover {
            background: linear-gradient(135deg, #B22222, #8B0000);
            transform: translateY(-2px);
        }
        
        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #E6E6FA;
            text-align: justify;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #FFD700;
            box-shadow: 0 5px 15px rgba(255,215,0,0.2);
        }
        
        .story-text p {
            margin-bottom: 20px;
        }
        
        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .book-cover img {
                max-width: 150px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                padding: 15px;
            }
            
            .btn {
                display: block;
                margin: 10px auto;
                width: 200px;
            }
            
            .language-navigation {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="rainbow-header"></div>
    
    <div class="container">
        <div class="book-cover">
            <img src="das-vermaechtnis-der-waechter.jpg" alt="Das Verm√§chtnis der W√§chter - Cover" />
        </div>
        
        <h1 id="main-title">Band 4: Das Verm√§chtnis der W√§chter</h1>
        <p class="author" id="author">von Helmut Wegner</p>
        
        <div class="controls">
            <div class="language-navigation">
                <a href="index.html" class="btn btn-nav">üè† Startseite</a>
                <button class="btn btn-lang active" onclick="switchLanguage('de')">üá©üá™ Deutsch</button>
                <button class="btn btn-lang" onclick="switchLanguage('en')">üá¨üáß English</button>
                <a href="high-fantasy.html" class="btn btn-nav">‚öîÔ∏è High Fantasy</a>
            </div>
            
            <div id="status-message" class="status-message" style="display: none;"></div>
            
            <button class="btn btn-read" onclick="startReading()">üîä <span id="btn-read-text">Vorlesen starten</span></button>
            <button class="btn btn-stop" onclick="stopReading()">‚èπÔ∏è <span id="btn-stop-text">Stoppen</span></button>
        </div>
        
        <!-- Deutsche Version -->
        <div id="de-content" class="language-content">
            <div class="story-text" id="storyText">
                <p>Tessa trat mit einem Stapel Karten in den H√§nden ein, ihr Gesicht von Vorfreude erf√ºllt. "Kael, schau dir das an! Ich habe in der Archivkammer eine Karte gefunden, die vielleicht unser n√§chstes Ziel sein k√∂nnte." Kael wandte sich langsam vom Fenster ab, seine Augen trafen die von Tessa. Ihre Begeisterung wirkte ansteckend, auch wenn er es sich nicht sofort anmerken lie√ü. Er nahm die oberste Karte entgegen, entfaltete sie behutsam und betrachtete die filigranen Linien, die eine Region zeigten, die ihm g√§nzlich unbekannt war. "Das ist jenseits der √∂stlichen Berge", stellte er fest und runzelte die Stirn. "Kein Mensch hat je behauptet, dort sei etwas anderes als √ñdnis."</p>

                <p>"Genau das ist es!" Tessa legte die √ºbrigen Karten auf den Tisch und st√ºtzte sich mit beiden H√§nden darauf. "Aber sieh dir die Markierungen hier an." Sie deutete auf eine kleine, fast √ºbersehene Notiz am Rand der Karte. "Das ist keine √ñdnis. Hier gibt es Hinweise auf eine alte Zivilisation. Vielleicht sogar auf das Ursprungsvolk von Eldoria." Kaels Neugier war geweckt. Die Worte "alte Zivilisation" hallten in seinem Geist wider, wie ein Echo, das einen l√§ngst vergessenen Traum wachrief. Ein leises Klopfen unterbrach ihre Unterhaltung. Als die T√ºr sich √∂ffnete, trat ein Fremder ein, dessen Erscheinung die Luft im Raum sofort schwerer wirken lie√ü. Er war in einen Umhang geh√ºllt, dessen Stoff so dunkel war wie die Nacht.</p>

                <p>Der Mann zog einen versiegelten Brief aus seiner Manteltasche und reichte ihn wortlos an Kael. Das Siegel trug das Wappen einer Region, die Kael nicht zuordnen konnte - eine Sonne, die hinter einem Gebirge versank. "Lest dies", sagte der Fremde, bevor er sich wortlos abwandte und verschwand, so lautlos wie ein Schatten. Kael √∂ffnete den Brief vorsichtig. "Die Zeit dr√§ngt", las Kael laut vor. "Die Schatten breiten sich aus, und ihr seid vielleicht die Letzten, die Eldoria retten k√∂nnen." Die beiden begannen, die Karten mit der Nachricht abzugleichen. Linien und Hinweise ergaben pl√∂tzlich einen Sinn, als w√ºrden sie ein verborgenes Mosaik zusammensetzen. "Wir m√ºssen morgen aufbrechen", entschied Kael schlie√ülich. "Wenn das, was in dem Brief steht, wahr ist, bleibt uns keine Zeit zu verlieren."</p>
            </div>
        </div>
        
        <!-- Englische Version -->
        <div id="en-content" class="language-content hidden">
            <div class="story-text" id="storyTextEn">
                <p>Tessa entered with a stack of maps in her hands, her face filled with anticipation. "Kael, look at this! I found a map in the archive chamber that might be our next destination." Kael slowly turned from the window, his eyes meeting Tessa's. Her enthusiasm was infectious, even if he didn't immediately show it. He took the top map, carefully unfolded it, and studied the delicate lines that showed a region completely unknown to him. "That's beyond the eastern mountains," he noted, frowning. "No one has ever claimed there's anything there but wasteland."</p>

                <p>"That's exactly it!" Tessa placed the remaining maps on the table and leaned on it with both hands. "But look at the markings here." She pointed to a small, almost overlooked note in the margin of the map. "This is no wasteland. There are hints of an ancient civilization here. Perhaps even the original people of Eldoria." Kael's curiosity was awakened. The words "ancient civilization" echoed in his mind, like an echo awakening a long-forgotten dream. A soft knock interrupted their conversation. When the door opened, a stranger entered whose appearance immediately made the air in the room feel heavier. He was wrapped in a cloak whose fabric was as dark as night.</p>

                <p>The man drew a sealed letter from his coat pocket and wordlessly handed it to Kael. The seal bore the coat of arms of a region Kael could not identify - a sun setting behind mountains. "Read this," said the stranger, before turning wordlessly and disappearing as silently as a shadow. Kael carefully opened the letter. "Time is pressing," Kael read aloud. "The shadows are spreading, and you may be the last ones who can save Eldoria." The two began to match the maps with the message. Lines and clues suddenly made sense, as if they were assembling a hidden mosaic. "We must leave tomorrow," Kael finally decided. "If what the letter says is true, we have no time to lose."</p>
            </div>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let isReading = false;
        let currentLanguage = 'de';
        let availableVoices = [];

        // Spracheinstellungen
        const languageTexts = {
            de: {
                title: "Band 4: Das Verm√§chtnis der W√§chter",
                author: "von Helmut Wegner",
                btnRead: "Vorlesen starten",
                btnStop: "Stoppen",
                lang: "de-DE",
                startMessage: "Vorlesen gestartet! üîä",
                stopMessage: "Vorlesen gestoppt. ‚èπÔ∏è",
                errorMessage: "Fehler: Vorlesen wird von diesem Browser nicht unterst√ºtzt.",
                noVoiceMessage: "Hinweis: Keine deutsche Stimme verf√ºgbar. Verwende Standardstimme."
            },
            en: {
                title: "Volume 4: The Legacy of the Guardians",
                author: "by Helmut Wegner",
                btnRead: "Start Reading",
                btnStop: "Stop",
                lang: "en-US",
                startMessage: "Reading started! üîä",
                stopMessage: "Reading stopped. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech not supported by this browser.",
                noVoiceMessage: "Note: No English voice available. Using default voice."
            }
        };

        function loadVoices() {
            return new Promise((resolve) => {
                availableVoices = speechSynthesis.getVoices();
                if (availableVoices.length > 0) {
                    resolve(availableVoices);
                } else {
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, { once: true });
                    setTimeout(() => {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, 1000);
                }
            });
        }

        function findBestVoice(targetLang) {
            if (availableVoices.length === 0) return null;
            let voice = availableVoices.find(v => v.lang === targetLang);
            if (voice) return voice;
            const langFamily = targetLang.split('-')[0];
            voice = availableVoices.find(v => v.lang.startsWith(langFamily));
            if (voice) return voice;
            return availableVoices[0];
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
            statusDiv.style.display = 'block';
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function switchLanguage(lang) {
            stopReading();
            
            document.querySelectorAll('.language-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(lang + '-content').classList.remove('hidden');
            
            document.querySelectorAll('.btn-lang').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentLanguage = lang;
            const texts = languageTexts[lang];
            document.getElementById('main-title').textContent = texts.title;
            document.getElementById('author').textContent = texts.author;
            document.getElementById('btn-read-text').textContent = texts.btnRead;
            document.getElementById('btn-stop-text').textContent = texts.btnStop;
            
            document.getElementById('status-message').style.display = 'none';
        }

        async function startReading() {
            if (!('speechSynthesis' in window)) {
                showStatus(languageTexts[currentLanguage].errorMessage, true);
                return;
            }

            stopReading();

            try {
                await loadVoices();

                const storyElement = document.querySelector(`#${currentLanguage}-content .story-text`);
                if (!storyElement) {
                    showStatus("Fehler: Text nicht gefunden.", true);
                    return;
                }

                const paragraphs = storyElement.querySelectorAll('p');
                if (paragraphs.length === 0) {
                    showStatus("Fehler: Keine Textabschnitte gefunden.", true);
                    return;
                }

                let textToRead = '';
                for (let i = 0; i < Math.min(3, paragraphs.length); i++) {
                    textToRead += paragraphs[i].textContent + ' ';
                }

                if (textToRead.trim().length === 0) {
                    showStatus("Fehler: Kein Text zum Vorlesen gefunden.", true);
                    return;
                }

                currentSpeech = new SpeechSynthesisUtterance(textToRead.trim());

                const targetLang = languageTexts[currentLanguage].lang;
                const bestVoice = findBestVoice(targetLang);

                if (bestVoice) {
                    currentSpeech.voice = bestVoice;
                    currentSpeech.lang = bestVoice.lang;
                } else {
                    currentSpeech.lang = targetLang;
                    showStatus(languageTexts[currentLanguage].noVoiceMessage, false);
                }

                currentSpeech.rate = 0.8;
                currentSpeech.volume = 1.0;
                currentSpeech.pitch = 1.0;

                currentSpeech.onstart = function() {
                    isReading = true;
                    showStatus(languageTexts[currentLanguage].startMessage);
                };

                currentSpeech.onend = function() {
                    isReading = false;
                    currentSpeech = null;
                    showStatus("Vorlesen beendet. ‚úÖ");
                };

                currentSpeech.onerror = function(event) {
                    isReading = false;
                    currentSpeech = null;
                    console.error('Speech error:', event);
                    showStatus("Fehler beim Vorlesen. Browser-Problem erkannt.", true);
                };

                try {
                    speechSynthesis.speak(currentSpeech);
                    setTimeout(() => {
                        if (currentSpeech && !speechSynthesis.speaking && !speechSynthesis.pending) {
                            showStatus("Vorlesen konnte nicht gestartet werden. Browser-Einschr√§nkung.", true);
                            isReading = false;
                            currentSpeech = null;
                        }
                    }, 2000);
                } catch (error) {
                    console.error('Speech synthesis error:', error);
                    showStatus("Fehler: " + error.message, true);
                    isReading = false;
                    currentSpeech = null;
                }

            } catch (error) {
                console.error('General error:', error);
                showStatus("Unerwarteter Fehler beim Vorlesen.", true);
                isReading = false;
                currentSpeech = null;
            }
        }

        function stopReading() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            if (currentSpeech) {
                currentSpeech = null;
            }
            if (isReading) {
                isReading = false;
                showStatus(languageTexts[currentLanguage].stopMessage);
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            if (!('speechSynthesis' in window)) {
                console.warn('Text-to-Speech wird von diesem Browser nicht unterst√ºtzt');
                showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                const readBtn = document.querySelector('.btn-read');
                readBtn.style.opacity = '0.5';
                readBtn.style.cursor = 'not-allowed';
                readBtn.onclick = function() {
                    showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                };
            } else {
                try {
                    await loadVoices();
                    console.log('Verf√ºgbare Stimmen:', availableVoices.length);
                } catch (error) {
                    console.error('Fehler beim Laden der Stimmen:', error);
                }
            }
        });

        window.addEventListener('beforeunload', function() {
            stopReading();
        });

        document.addEventListener('touchstart', function() {
            if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                const dummySpeech = new SpeechSynthesisUtterance('');
                dummySpeech.volume = 0;
                speechSynthesis.speak(dummySpeech);
            }
        }, { once: true });
    </script>
</body>
</html>
