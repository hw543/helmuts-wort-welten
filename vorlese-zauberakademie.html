<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zauberakademie – Vorlesen mit Wortmarkierung</title>
    <style>
        /*
         * Dieses Layout basiert auf den bestehenden Vorleseseiten der
         * Mondstein‑Reihe. Es wurde so angepasst, dass sowohl die
         * deutsche als auch die englische Version der Geschichte
         * dargestellt und wortweise hervorgehoben werden können.
         */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            background: linear-gradient(135deg, #FFE5B4 0%, #FFB6C1 50%, #98FB98 100%);
            min-height: 100vh;
        }
        .rainbow-header {
            height: 20px;
            background: linear-gradient(90deg,
                #FF0000 0%,
                #FF7F00 14%,
                #FFFF00 28%,
                #00FF00 42%,
                #0000FF 56%,
                #4B0082 70%,
                #9400D3 84%,
                #FF1493 100%);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        .container {
            max-width: 900px;
            margin: 20px auto;
            background: linear-gradient(135deg, #FFF8DC 0%, #F0F8FF 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid #FFD700;
        }
        h1 {
            color: #FF6347;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255,105,180,0.3);
        }
        .author {
            text-align: center;
            color: #9370DB;
            font-style: italic;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        .controls {
            position: sticky;
            top: 10px;
            text-align: center;
            margin: 20px 0;
            padding: 20px;
            background: linear-gradient(135deg, #FFE4E1 0%, #E6E6FA 100%);
            border-radius: 15px;
            border: 2px solid #FFB6C1;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(255,182,193,0.3);
        }
        .language-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 20px;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #ffffff;
            text-decoration: none;
        }
        .btn-lang {
            background: linear-gradient(135deg, #9370DB, #8A2BE2);
        }
        .btn-lang.active {
            border: 2px solid #FFD700;
            box-shadow: 0 0 10px rgba(255,215,0,0.8);
        }
        .btn-play {
            background: linear-gradient(135deg, #32CD32, #228B22);
        }
        .btn-continue {
            background: linear-gradient(135deg, #4F8F56, #356C3F);
        }
        .btn-stop {
            background: linear-gradient(135deg, #FF6347, #FF4500);
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.25);
        }
        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #2F4F4F;
            text-align: justify;
            background: linear-gradient(135deg, #FFFAF0 0%, #FFF8DC 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #DDA0DD;
            box-shadow: 0 5px 15px rgba(221,160,221,0.2);
            margin-bottom: 30px;
        }
        .word {
            cursor: pointer;
            transition: all 0.2s ease;
            padding: 1px 2px;
            border-radius: 3px;
        }
        .word:hover {
            background-color: rgba(161,217,155,0.2);
        }
        .word-highlight {
            background-color: #4169E1;
            color: #ffffff;
            padding: 2px 4px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(65,105,225,0.3);
        }
        .language-content.hidden {
            display: none;
        }
        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
            display: none;
        }
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            .btn {
                width: 100%;
                margin-bottom: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="rainbow-header"></div>
    <div class="container">
        <h1 id="main-title">Die Zauberakademie von Morgenstern</h1>
        <div id="author" class="author">von Helmut Wegner</div>
        <div class="controls">
            <div class="language-navigation">
                <button class="btn btn-lang active" id="btn-de" onclick="switchLanguage('de', event)">Deutsch</button>
                <button class="btn btn-lang" id="btn-en" onclick="switchLanguage('en', event)">English</button>
            </div>
            <div class="control-buttons">
                <button id="btn-play" class="btn btn-play" onclick="startReading()">▶️ Vorlesen</button>
                <button id="btn-continue" class="btn btn-continue" onclick="continueReading()">⏩ Weiterlesen</button>
                <button id="btn-stop" class="btn btn-stop" onclick="stopReading()">⏹️ Stop</button>
            </div>
        </div>
        <!-- Deutscher Inhalt -->
        <div id="de-content" class="language-content">
            <div class="story-text">
                <p>Die Morgenluft war kühl und klar, als Leonas Grünfeld seinen Schulranzen über die Schulter schwang und den staubigen Weg zur Schule einschlug. Der Pfad schlängelte sich zwischen alten Eichen hindurch, deren Äste sich wie schützende Arme über ihm verwarfen und Schatten auf den ausgetretenen Weg warfen. Sein Dorf, eingebettet in weite Felder und dichte Wälder, erwachte langsam zum Leben. Die Morgensonne malte goldene Streifen über die Wiesen, auf denen der Tau wie tausend kleine Diamanten funkelte.</p>
                <p>Kühe muhten leise in der Ferne, ihre Stimmen mischten sich mit dem Gezwitscher der Vögel, die ihre Morgenlieder sangen. Die ersten warmen Sonnenstrahlen brachen durch die Baumwipfel und ließen die Blätter in allen Grüntönen leuchten. Für andere mochte es ein gewöhnlicher Tag sein, aber Leonas spürte eine ungewöhnliche Anspannung in der Luft, ein seltsames Kribbeln, das über seine Haut wanderte und ihn innerlich unruhig machte.</p>
                <p>Leonas war ein schüchterner Junge von zwölf Jahren mit strohblondem Haar, das ihm ständig in die Stirn fiel, und grünen Augen, die oft gedankenverloren und etwas melancholisch in die Ferne blickten. Seine Haut war blass, da er die meiste Zeit im Schatten der Bäume verbrachte, und seine Hände waren stets ein wenig schmutzig von der Erde, in der er gerne grub, um Käfer und Würmer zu beobachten.</p>
                <p>Er mied die lauten Kinder in seiner Klasse und verbrachte seine Zeit lieber mit den Tieren des Waldes, die ihn nie verspotteten oder ausschlossen. Seine Schritte waren leise und vorsichtig, als ob er versuchte, möglichst unsichtbar zu bleiben, während er durch die Welt streifte. Er bewegte sich oft wie ein Schatten, geschmeidig und unbemerkt – eine Eigenschaft, die er sich im Laufe der Jahre des Ausweichens und Versteckens angeeignet hatte.</p>
                <p>Die anderen Kinder in der Schule verstanden ihn nicht, und er verstand sie genauso wenig. Während sie sich für Ballspiele und laute Späße begeisterten, für die neuesten Spielsachen und Trends, fand Leonas Trost in der stillen Beobachtung von Käfern, die über raue Baumrinde krabbelten, oder von Vögeln, die geschickt ihre Nester aus Zweigen und Moos bauten.</p>
                <p>Er wurde oft dafür gehänselt, besonders von Jasper und seiner Clique, einer Gruppe von fünf Jungen, die sich selbst für die Könige des Schulhofs hielten. Jasper war ihr Anführer, ein großer, kräftiger Junge mit dünnem braunen Haar und kleinen, stechenden Augen, die ständig nach Schwächen suchten.</p>
            </div>
        </div>
        <!-- Englischer Inhalt -->
        <div id="en-content" class="language-content hidden">
            <div class="story-text">
                <p>The morning air was cool and clear as Leonas Grünfeld slung his school bag over his shoulder and set off on the dusty path to school. The trail wound between old oak trees, whose branches wove together like protective arms above him, casting shadows on the worn path. His village, nestled in wide fields and dense forests, was slowly awakening to life. The morning sun painted golden stripes across the meadows, where dew sparkled like thousands of tiny diamonds.</p>
                <p>Cows lowed softly in the distance, their voices mixing with the chirping of birds singing their morning songs. The first warm rays of sunlight broke through the treetops, making the leaves glow in every shade of green. For others, it might have been an ordinary day, but Leonas sensed an unusual tension in the air, a strange tingling that wandered over his skin and made him feel restless inside.</p>
                <p>Leonas was a shy boy of twelve with straw‑blonde hair that constantly fell into his forehead, and green eyes that often gazed thoughtfully and somewhat melancholically into the distance. His skin was pale, as he spent most of his time in the shade of trees, and his hands were always a little dirty from the earth he liked to dig in to observe beetles and worms.</p>
                <p>He avoided the loud children in his class and preferred to spend time with the animals of the forest, who never mocked or excluded him. His steps were quiet and careful, as if he were trying to remain as invisible as possible while wandering through the world. He often moved like a shadow, smooth and unnoticed – a trait he had acquired over years of avoiding and hiding.</p>
                <p>The other children at school didn't understand him, and he understood them just as little. While they were enthusiastic about ball games and loud jokes, about the latest toys and trends, Leonas found comfort in the quiet observation of beetles crawling over rough tree bark, or birds skilfully building their nests from twigs and moss.</p>
                <p>He was often mocked for this, especially by Jasper and his clique, a group of five boys who considered themselves the kings of the schoolyard. Jasper was their leader, a tall, strong boy with thin brown hair and small, piercing eyes that always searched for weakness.</p>
            </div>
        </div>
        <!-- Status-Meldungen können hier ausgegeben werden -->
        <div id="status-message" class="status-message" style="display:none;"></div>
    </div>
    <script>
        let currentSpeech = null;
        let currentLanguage = 'de';
        let currentWordIndex = 0;
        let lastHighlightedWord = null;
        const allWords = { de: [], en: [] };
        // Kein explizites Voice‑Management nötig – es wird die Standardsprache des Browsers verwendet.

        // Teilt alle Wörter in Spans auf und initialisiert allWords
        function initializeWords() {
            ['de', 'en'].forEach(lang => {
                const container = document.getElementById(`${lang}-content`);
                const paragraphs = container.querySelectorAll('p');
                let wordCounter = 0;
                allWords[lang] = [];
                paragraphs.forEach(paragraph => {
                    const words = paragraph.textContent.trim().split(/\s+/);
                    let html = '';
                    words.forEach(word => {
                        // HTML escapes für Sonderzeichen
                        const safeWord = word.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                        html += `<span class="word" data-index="${wordCounter}" onclick="startFromWord(${wordCounter})">${safeWord}</span> `;
                        allWords[lang].push(word);
                        wordCounter++;
                    });
                    paragraph.innerHTML = html.trim();
                });
            });
        }

        function highlightWord(index) {
            if (lastHighlightedWord) {
                lastHighlightedWord.classList.remove('word-highlight');
            }
            const element = document.querySelector(`#${currentLanguage}-content .word[data-index="${index}"]`);
            if (element) {
                element.classList.add('word-highlight');
                lastHighlightedWord = element;
                element.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }


        function startReading() {
            // Setze die Wortposition zurück und breche ggf. laufende Ausgaben ab
            currentWordIndex = 0;
            if (currentSpeech) {
                speechSynthesis.cancel();
            }
            // Starte das Vorlesen sofort
            continueReading();
        }

        function continueReading() {
            if (currentSpeech) {
                // Bestehenden Vorlesevorgang abbrechen
                speechSynthesis.cancel();
            }
            const words = allWords[currentLanguage];
            if (words && words.length > currentWordIndex) {
                // Gesamten restlichen Text ab der aktuellen Position vorlesen
                const remainingText = words.slice(currentWordIndex).join(' ');
                currentSpeech = new SpeechSynthesisUtterance(remainingText);
                // Einheitliche Geschwindigkeit für beide Sprachen
                currentSpeech.rate = 1.0;
                // Sprache entsprechend der Auswahl setzen
                currentSpeech.lang = currentLanguage === 'de' ? 'de-DE' : 'en-US';
                let localIndex = currentWordIndex;
                currentSpeech.onboundary = function(event) {
                    if (event.name === 'word') {
                        highlightWord(localIndex);
                        localIndex++;
                        currentWordIndex = localIndex;
                    }
                };
                currentSpeech.onend = function() {
                    // Nach Abschluss keine weitere Aktion
                };
                speechSynthesis.speak(currentSpeech);
            }
        }

        function startFromWord(index) {
            currentWordIndex = index;
            if (currentSpeech) {
                speechSynthesis.cancel();
            }
            continueReading();
        }

        function stopReading() {
            if (currentSpeech) {
                speechSynthesis.cancel();
                currentSpeech = null;
            }
        }

        function switchLanguage(lang, event) {
            // Beim Wechseln der Sprache stoppen wir die aktuelle Lesung
            stopReading();
            currentLanguage = lang;
            currentWordIndex = 0;
            // Sichtbarkeit der Sprachblöcke umschalten
            document.querySelectorAll('.language-content').forEach(elem => elem.classList.add('hidden'));
            document.getElementById(`${lang}-content`).classList.remove('hidden');
            // Beschriftungen der Buttons abhängig von der Sprache setzen
            const labels = {
                de: { play: 'Vorlesen', cont: 'Weiterlesen', stop: 'Stop' },
                en: { play: 'Read', cont: 'Continue', stop: 'Stop' }
            };
            document.getElementById('btn-play').innerHTML = `▶️ ${labels[lang].play}`;
            document.getElementById('btn-continue').innerHTML = `⏩ ${labels[lang].cont}`;
            document.getElementById('btn-stop').innerHTML = `⏹️ ${labels[lang].stop}`;
            // Aktiven Sprachbutton hervorheben
            document.querySelectorAll('.btn-lang').forEach(btn => btn.classList.remove('active'));
            if (event && event.target) {
                event.target.classList.add('active');
            }
            // zum Anfang der neuen Sprache scrollen
            const topElem = document.querySelector(`#${lang}-content`);
            if (topElem) {
                topElem.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Wörter vorbereiten und Standard‑Sprache auf Deutsch setzen
            initializeWords();
            switchLanguage('de');
        });
    </script>
</body>
</html>
