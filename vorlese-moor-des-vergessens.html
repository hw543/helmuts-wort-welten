<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Moor des Vergessens - Vorlesen</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f1419 100%);
            min-height: 100vh;
        }
        
        .rainbow-header {
            height: 20px;
            background: linear-gradient(90deg, 
                #2F4F4F 0%, 
                #708090 14%, 
                #696969 28%, 
                #556B2F 42%, 
                #2E8B57 56%, 
                #008080 70%, 
                #191970 84%, 
                #000000 100%);
            box-shadow: 0 3px 10px rgba(47,79,79,0.5);
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            background: linear-gradient(135deg, #1e1e3a 0%, #2a2a4a 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            border: 3px solid #708090;
        }
        
        h1 {
            color: #708090;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(112,128,144,0.7);
        }
        
        .author {
            text-align: center;
            color: #2E8B57;
            font-style: italic;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .controls {
            position: sticky;
            top: 20px;
            text-align: center;
            margin: 30px 0 10px 0;
            padding: 20px;
            background: linear-gradient(135deg, #2F4F4F 0%, #1e1e3a 100%);
            border-radius: 15px;
            border: 2px solid #708090;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(112,128,144,0.4);
        }
        
        .language-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-lang {
            background: linear-gradient(135deg, #708090, #2F4F4F);
            color: white;
            border: 2px solid transparent;
        }
        
        .btn-lang.active {
            border-color: #2E8B57;
            box-shadow: 0 0 15px rgba(46, 139, 87, 0.8);
        }
        
        .btn-lang:hover {
            background: linear-gradient(135deg, #2F4F4F, #556B2F);
            transform: translateY(-2px);
        }
        
        .btn-nav {
            background: linear-gradient(135deg, #556B2F, #2E8B57);
            color: white;
            text-decoration: none;
            border: 2px solid transparent;
        }
        
        .btn-nav:hover {
            background: linear-gradient(135deg, #2E8B57, #008080);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46,139,87,0.5);
        }
        
        .btn-read {
            background: linear-gradient(135deg, #228B22, #006400);
            color: white;
        }
        
        .btn-read:hover {
            background: linear-gradient(135deg, #006400, #004000);
            transform: translateY(-2px);
        }
        
        .btn-stop {
            background: linear-gradient(135deg, #DC143C, #B22222);
            color: white;
        }
        
        .btn-stop:hover {
            background: linear-gradient(135deg, #B22222, #8B0000);
            transform: translateY(-2px);
        }
        
        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #F5F5DC;
            text-align: justify;
            background: linear-gradient(135deg, #0f1419 0%, #1a1a2e 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #708090;
            box-shadow: 0 5px 15px rgba(112,128,144,0.3);
        }
        
        .story-text p {
            margin-bottom: 20px;
        }
        
        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                padding: 15px;
            }
            
            .btn {
                display: block;
                margin: 10px auto;
                width: 200px;
            }
            
            .language-navigation {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="rainbow-header"></div>
    
    <div class="container">
        <h1 id="main-title">Band 2: Moor des Vergessens</h1>
        <p class="author" id="author">von Helmut Wegner</p>
        
        <div class="controls">
            <div class="language-navigation">
                <a href="index.html" class="btn btn-nav">üè† Startseite</a>
                <button class="btn btn-lang active" onclick="switchLanguage('de')">üá©üá™ Deutsch</button>
                <button class="btn btn-lang" onclick="switchLanguage('en')">üá¨üáß English</button>
                <a href="mysterien-der-heide.html" class="btn btn-nav">üïµÔ∏è Zur√ºck zur Serie</a>
            </div>
            
            <div id="status-message" class="status-message" style="display: none;"></div>
            
            <button class="btn btn-read" onclick="startReading()">üîä <span id="btn-read-text">Vorlesen starten</span></button>
            <button class="btn btn-stop" onclick="stopReading()">‚èπÔ∏è <span id="btn-stop-text">Stoppen</span></button>
        </div>
        
        <!-- Deutsche Version -->
        <div id="de-content" class="language-content">
            <div class="story-text" id="storyText">
                <p>Es war ein grauer, nebliger Morgen im kleinen Dorf Eldermoor, das inmitten einer endlosen Moorlandschaft verborgen lag. Das Licht der ersten Sonne k√§mpfte vergeblich gegen die dichte Nebeldecke, die sich wie ein undurchdringlicher Schleier √ºber die Landschaft legte. Jakob, ein alter J√§ger und Fr√ºhaufsteher, stapfte mit festem Schritt durch die matschigen Wege, die zu den lichtlosen Tiefen des Moors f√ºhrten. Doch an diesem Morgen war die Stille des Moors anders. Ein unheimliches Gef√ºhl hatte sich in seine Brust geschlichen, das er nicht ignorieren konnte.</p>

                <p>Pl√∂tzlich blieb Jakob stehen. Eine Bewegung, ein Schimmer zwischen den dichten Schilfpflanzen, hatte seine Aufmerksamkeit erregt. Dann, als er n√§herkam, erkannte er das Grauenhafte. Ein Schrei blieb ihm im Hals stecken, als er die Gestalt im Moor sah. Eine Leiche, reglos und verwittert, lag im glitschigen Schlamm. Die Gesichtsz√ºge waren entstellt, die Haut blass und von der Zeit gezeichnet. "Was zum Teufel ist hier geschehen?", murmelte er, w√§hrend er hastig die R√ºckkehr ins Dorf antrat. Die Nachricht verbreitete sich wie ein Lauffeuer.</p>

                <p>Als die Polizei, angef√ºhrt von Kommissarin Anna Hartmann, im Dorf eintraf, war die Atmosph√§re bereits aufgeladen. Anna kannte Eldermoor, die Geschichten und Legenden, die sich um das Moor rankten. Als sie den Fundort erreichte, stieg ihr der faulige Geruch des Moores in die Nase. Anna kniete sich nieder und hob vorsichtig das Tuch an. Die Leiche war verwittert, das Gesicht nicht mehr zu erkennen, aber es war deutlich, dass sie schon lange hier lag. "Wer bist du?", murmelte sie leise. Die ersten Ermittlungen begannen, und Anna wusste, dass dies kein gew√∂hnlicher Mordfall war. Die Spuren im Moor waren nicht klar, und die Leiche wirkte, als w√§re sie sorgsam platziert worden.</p>
            </div>
        </div>
        
        <!-- Englische Version -->
        <div id="en-content" class="language-content hidden">
            <div class="story-text" id="storyTextEn">
                <p>It was a gray, foggy morning in the small village of Eldermoor, hidden amidst an endless moorland landscape. The light of the first sun fought in vain against the dense fog cover that lay like an impenetrable veil over the landscape. Jakob, an old hunter and early riser, trudged with firm steps through the muddy paths that led to the lightless depths of the moor. But this morning the silence of the moor was different. An eerie feeling had crept into his chest that he could not ignore.</p>

                <p>Suddenly Jakob stopped. A movement, a shimmer between the dense reed plants, had caught his attention. Then, as he came closer, he recognized the horrible. A scream stuck in his throat as he saw the figure in the moor. A corpse, motionless and weathered, lay in the slippery mud. The facial features were disfigured, the skin pale and marked by time. "What the hell happened here?" he muttered as he hastily made his way back to the village. The news spread like wildfire.</p>

                <p>When the police, led by Commissioner Anna Hartmann, arrived in the village, the atmosphere was already charged. Anna knew Eldermoor, the stories and legends that surrounded the moor. When she reached the site, the putrid smell of the moor rose to her nose. Anna knelt down and carefully lifted the cloth. The corpse was weathered, the face no longer recognizable, but it was clear that it had been lying here for a long time. "Who are you?" she murmured quietly. The first investigations began, and Anna knew this was no ordinary murder case. The traces in the moor were unclear, and the corpse seemed as if it had been carefully placed.</p>
            </div>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let isReading = false;
        let currentLanguage = 'de';
        let availableVoices = [];

        // Spracheinstellungen
        const languageTexts = {
            de: {
                title: "Band 2: Moor des Vergessens",
                author: "von Helmut Wegner",
                btnRead: "Vorlesen starten",
                btnStop: "Stoppen",
                lang: "de-DE",
                startMessage: "Vorlesen gestartet! üîä",
                stopMessage: "Vorlesen gestoppt. ‚èπÔ∏è",
                errorMessage: "Fehler: Vorlesen wird von diesem Browser nicht unterst√ºtzt.",
                noVoiceMessage: "Hinweis: Keine deutsche Stimme verf√ºgbar. Verwende Standardstimme."
            },
            en: {
                title: "Volume 2: Moor of Forgetting",
                author: "by Helmut Wegner",
                btnRead: "Start Reading",
                btnStop: "Stop",
                lang: "en-US",
                startMessage: "Reading started! üîä",
                stopMessage: "Reading stopped. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech not supported by this browser.",
                noVoiceMessage: "Note: No English voice available. Using default voice."
            }
        };

        function loadVoices() {
            return new Promise((resolve) => {
                availableVoices = speechSynthesis.getVoices();
                if (availableVoices.length > 0) {
                    resolve(availableVoices);
                } else {
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, { once: true });
                    setTimeout(() => {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, 1000);
                }
            });
        }

        function findBestVoice(targetLang) {
            if (availableVoices.length === 0) return null;
            let voice = availableVoices.find(v => v.lang === targetLang);
            if (voice) return voice;
            const langFamily = targetLang.split('-')[0];
            voice = availableVoices.find(v => v.lang.startsWith(langFamily));
            if (voice) return voice;
            return availableVoices[0];
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
            statusDiv.style.display = 'block';
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function switchLanguage(lang) {
            // Stoppe aktuelles Vorlesen
            stopReading();
            
            // Verstecke alle Sprachen
            document.querySelectorAll('.language-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Zeige ausgew√§hlte Sprache
            document.getElementById(lang + '-content').classList.remove('hidden');
            
            // Update Sprachbuttons
            document.querySelectorAll('.btn-lang').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update Texte
            currentLanguage = lang;
            const texts = languageTexts[lang];
            document.getElementById('main-title').textContent = texts.title;
            document.getElementById('author').textContent = texts.author;
            document.getElementById('btn-read-text').textContent = texts.btnRead;
            document.getElementById('btn-stop-text').textContent = texts.btnStop;
            
            // Status verstecken
            document.getElementById('status-message').style.display = 'none';
        }

        async function startReading() {
            if (!('speechSynthesis' in window)) {
                showStatus(languageTexts[currentLanguage].errorMessage, true);
                return;
            }

            stopReading();

            try {
                await loadVoices();

                const storyElement = document.querySelector(`#${currentLanguage}-content .story-text`);
                if (!storyElement) {
                    showStatus("Fehler: Text nicht gefunden.", true);
                    return;
                }

                const paragraphs = storyElement.querySelectorAll('p');
                if (paragraphs.length === 0) {
                    showStatus("Fehler: Keine Textabschnitte gefunden.", true);
                    return;
                }

                // NUR ERSTE 3 ABS√ÑTZE (WELTWEIT KOMPATIBEL)
                let textToRead = '';
                for (let i = 0; i < Math.min(3, paragraphs.length); i++) {
                    textToRead += paragraphs[i].textContent + ' ';
                }

                if (textToRead.trim().length === 0) {
                    showStatus("Fehler: Kein Text zum Vorlesen gefunden.", true);
                    return;
                }

                currentSpeech = new SpeechSynthesisUtterance(textToRead.trim());

                const targetLang = languageTexts[currentLanguage].lang;
                const bestVoice = findBestVoice(targetLang);

                if (bestVoice) {
                    currentSpeech.voice = bestVoice;
                    currentSpeech.lang = bestVoice.lang;
                } else {
                    currentSpeech.lang = targetLang;
                    showStatus(languageTexts[currentLanguage].noVoiceMessage, false);
                }

                // OPTIMIERTE EINSTELLUNGEN
                currentSpeech.rate = 0.8;
                currentSpeech.volume = 1.0;
                currentSpeech.pitch = 1.0;

                currentSpeech.onstart = function() {
                    isReading = true;
                    showStatus(languageTexts[currentLanguage].startMessage);
                };

                currentSpeech.onend = function() {
                    isReading = false;
                    currentSpeech = null;
                    showStatus("Vorlesen beendet. ‚úÖ");
                };

                currentSpeech.onerror = function(event) {
                    isReading = false;
                    currentSpeech = null;
                    console.error('Speech error:', event);
                    showStatus("Fehler beim Vorlesen. Browser-Problem erkannt.", true);
                };

                try {
                    speechSynthesis.speak(currentSpeech);
                    setTimeout(() => {
                        if (currentSpeech && !speechSynthesis.speaking && !speechSynthesis.pending) {
                            showStatus("Vorlesen konnte nicht gestartet werden. Browser-Einschr√§nkung.", true);
                            isReading = false;
                            currentSpeech = null;
                        }
                    }, 2000);
                } catch (error) {
                    console.error('Speech synthesis error:', error);
                    showStatus("Fehler: " + error.message, true);
                    isReading = false;
                    currentSpeech = null;
                }

            } catch (error) {
                console.error('General error:', error);
                showStatus("Unerwarteter Fehler beim Vorlesen.", true);
                isReading = false;
                currentSpeech = null;
            }
        }

        function stopReading() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            if (currentSpeech) {
                currentSpeech = null;
            }
            if (isReading) {
                isReading = false;
                showStatus(languageTexts[currentLanguage].stopMessage);
            }
        }

        // BROWSER-KOMPATIBILIT√ÑT PR√úFUNG
        document.addEventListener('DOMContentLoaded', async function() {
            if (!('speechSynthesis' in window)) {
                console.warn('Text-to-Speech wird von diesem Browser nicht unterst√ºtzt');
                showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                const readBtn = document.querySelector('.btn-read');
                readBtn.style.opacity = '0.5';
                readBtn.style.cursor = 'not-allowed';
                readBtn.onclick = function() {
                    showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                };
            } else {
                try {
                    await loadVoices();
                    console.log('Verf√ºgbare Stimmen:', availableVoices.length);
                } catch (error) {
                    console.error('Fehler beim Laden der Stimmen:', error);
                }
            }
        });

        // CLEANUP
        window.addEventListener('beforeunload', function() {
            stopReading();
        });

        // MOBILE SAFARI FIX
        document.addEventListener('touchstart', function() {
            if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                const dummySpeech = new SpeechSynthesisUtterance('');
                dummySpeech.volume = 0;
                speechSynthesis.speak(dummySpeech);
            }
        }, { once: true });
    </script>
</body>
</html>
