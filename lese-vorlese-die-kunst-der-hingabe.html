<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Die Kunst der Hingabe - Vorlesen</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            color: #2c1810;
            background: linear-gradient(135deg, #FFE5E5 0%, #FFB6C1 25%, #FF69B4 50%, #FFC0CB 75%, #FFCCCB 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: #FFF8F0;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #C2185B, #8B1538);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .back-button-header {
            position: absolute;
            top: 15px;
            left: 15px;
        }

        .back-button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 20px;
            text-decoration: none;
            font-size: 0.9em;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2em;
            opacity: 0.9;
            font-style: italic;
        }

        .controls {
            position: sticky;
            top: 20px;
            text-align: center;
            margin: 30px 0 10px 0;
            padding: 20px;
            background: linear-gradient(135deg, #FFF0F5 0%, #FFE4E6 100%);
            border-radius: 15px;
            border: 2px solid #C2185B;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(194, 24, 91, 0.3);
        }

        .language-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .btn-lang {
            background: linear-gradient(135deg, #C2185B, #8B1538);
            color: white;
            border: 2px solid transparent;
        }

        .btn-lang.active {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }

        .btn-lang:hover {
            background: linear-gradient(135deg, #8B1538, #AD1457);
            transform: translateY(-2px);
        }

        .btn-nav {
            background: linear-gradient(135deg, #4285f4, #1976d2);
            color: white;
            text-decoration: none;
            border: 2px solid transparent;
        }

        .btn-nav:hover {
            background: linear-gradient(135deg, #1976d2, #0d47a1);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(66, 133, 244, 0.4);
        }

        .btn-read {
            background: linear-gradient(135deg, #32CD32, #228B22);
            color: white;
        }

        .btn-read:hover {
            background: linear-gradient(135deg, #228B22, #006400);
            transform: translateY(-2px);
        }

        .btn-stop {
            background: linear-gradient(135deg, #FF6347, #FF4500);
            color: white;
        }

        .btn-stop:hover {
            background: linear-gradient(135deg, #FF4500, #FF2400);
            transform: translateY(-2px);
        }

        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #2F4F4F;
            text-align: justify;
            background: linear-gradient(135deg, #FFFAF0 0%, #FFF8DC 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #DDA0DD;
            box-shadow: 0 5px 15px rgba(221,160,221,0.2);
            margin: 20px;
        }

        .story-text p {
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }

        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
        }

        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }

            .header h1 {
                font-size: 2em;
            }

            .controls {
                padding: 15px;
            }

            .btn {
                display: block;
                margin: 10px auto;
                width: 200px;
            }

            .language-navigation {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .story-text {
                padding: 20px;
                margin: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="back-button-header">
                <a href="die-verborgenen-kammern.html" class="back-button">‚Üê Zur√ºck zur Serie</a>
            </div>
            <h1 id="main-title">üåπ Die Kunst der Hingabe</h1>
            <p id="author">von Helmut Wegner</p>
        </div>

        <div class="controls">
            <div class="language-navigation">
                <a href="index.html" class="btn btn-nav">üè† Startseite</a>
                <button class="btn btn-lang active" onclick="switchLanguage('de')">üá©üá™ Deutsch</button>
                <button class="btn btn-lang" onclick="switchLanguage('en')">üá¨üáß English</button>
                <a href="romantik-fiktion.html" class="btn btn-nav">üíï Romantik</a>
            </div>

            <div id="status-message" class="status-message" style="display: none;"></div>

            <button class="btn btn-read" onclick="startReading()">üîä <span id="btn-read-text">Vorlesen starten</span></button>
            <button class="btn btn-stop" onclick="stopReading()">‚èπÔ∏è <span id="btn-stop-text">Stoppen</span></button>
        </div>

        <!-- Deutsche Version -->
        <div id="de-content" class="language-content">
            <div class="story-text" id="storyText">
                <p>Die Nachricht vom Tod seiner Tante Marie erreichte Marcus an einem k√ºhlen Herbstmorgen. Die Sonne stand tief am Horizont und tauchte die toskanische Landschaft in ein goldenes Licht. Elena, die an seiner Seite stand, sp√ºrte die Last der Nachricht, die schwer auf Marcus' Schultern ruhte. Marie war nicht nur eine Verwandte gewesen, sondern auch die H√ºterin eines Erbes, das weit √ºber Kunst und Geschichte hinausging.</p>

                <p>In der gro√üen Halle des Familienanwesens versammelte sich die Familie. Als das Testament verlesen wurde, sp√ºrte Elena, wie sich die Atmosph√§re ver√§nderte. Marie hatte Marcus eine verschl√ºsselte Botschaft hinterlassen, die von einem Erbe sprach, das weit mehr war als nur materieller Besitz. Ein verlorener Schatz, der die Familie seit Generationen begleitete.</p>

                <p>"Was denkst du, was sie uns damit sagen will?", fragte Elena leise. Marcus hob den Blick und sah sie an, seine Augen spiegelten eine Mischung aus Trauer und Entschlossenheit wider. "Marie war immer eine Meisterin der Geheimnisse. Sie wollte, dass wir die Wahrheit selbst herausfinden." Elena legte sanft ihre Hand auf seine Schulter. "Wir werden es gemeinsam herausfinden."</p>
            </div>
        </div>

        <!-- Englische Version -->
        <div id="en-content" class="language-content hidden">
            <div class="story-text" id="storyTextEn">
                <p>The news of his aunt Marie's death reached Marcus on a cool autumn morning. The sun stood low on the horizon, bathing the Tuscan landscape in golden light. Elena, standing by his side, felt the weight of the news that rested heavily on Marcus' shoulders. Marie had not just been a relative, but also the guardian of a legacy that went far beyond art and history.</p>

                <p>In the great hall of the family estate, the family gathered. When the will was read, Elena felt the atmosphere change. Marie had left Marcus an encrypted message that spoke of a legacy that was far more than just material possessions. A lost treasure that had accompanied the family for generations.</p>

                <p>"What do you think she wanted to tell us?" Elena asked quietly. Marcus looked up and met her eyes, his gaze reflecting a mixture of grief and determination. "Marie was always a master of secrets. She wanted us to find the truth ourselves." Elena gently placed her hand on his shoulder. "We'll figure it out together."</p>
            </div>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let isReading = false;
        let currentLanguage = 'de';
        let availableVoices = [];

        const languageTexts = {
            de: {
                title: "üåπ Die Kunst der Hingabe",
                author: "von Helmut Wegner",
                btnRead: "Vorlesen starten",
                btnStop: "Stoppen",
                lang: "de-DE",
                startMessage: "Vorlesen gestartet! üîä",
                stopMessage: "Vorlesen gestoppt. ‚èπÔ∏è",
                errorMessage: "Fehler: Vorlesen wird von diesem Browser nicht unterst√ºtzt.",
                noVoiceMessage: "Hinweis: Keine deutsche Stimme verf√ºgbar. Verwende Standardstimme."
            },
            en: {
                title: "üåπ The Art of Devotion",
                author: "by Helmut Wegner",
                btnRead: "Start Reading",
                btnStop: "Stop",
                lang: "en-US",
                startMessage: "Reading started! üîä",
                stopMessage: "Reading stopped. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech not supported by this browser.",
                noVoiceMessage: "Note: No English voice available. Using default voice."
            }
        };

        function loadVoices() {
            return new Promise((resolve) => {
                availableVoices = speechSynthesis.getVoices();
                
                if (availableVoices.length > 0) {
                    resolve(availableVoices);
                } else {
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, { once: true });
                    
                    setTimeout(() => {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, 1000);
                }
            });
        }

        function findBestVoice(targetLang) {
            if (availableVoices.length === 0) {
                return null;
            }

            let voice = availableVoices.find(v => v.lang === targetLang);
            if (voice) return voice;

            const langFamily = targetLang.split('-')[0];
            voice = availableVoices.find(v => v.lang.startsWith(langFamily));
            if (voice) return voice;

            return availableVoices[0];
        }

        function switchLanguage(lang) {
            stopReading();
            
            document.querySelectorAll('.language-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(lang + '-content').classList.remove('hidden');
            
            document.querySelectorAll('.btn-lang').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentLanguage = lang;
            const texts = languageTexts[lang];
            document.getElementById('main-title').textContent = texts.title;
            document.getElementById('author').textContent = texts.author;
            document.getElementById('btn-read-text').textContent = texts.btnRead;
            document.getElementById('btn-stop-text').textContent = texts.btnStop;
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        async function startReading() {
            if (!('speechSynthesis' in window)) {
                showStatus(languageTexts[currentLanguage].errorMessage, true);
                return;
            }

            stopReading();

            try {
                await loadVoices();

                const storyElement = document.querySelector(`#${currentLanguage}-content .story-text`);
                if (!storyElement) {
                    showStatus("Fehler: Text nicht gefunden.", true);
                    return;
                }

                const paragraphs = storyElement.querySelectorAll('p');
                if (paragraphs.length === 0) {
                    showStatus("Fehler: Keine Textabschnitte gefunden.", true);
                    return;
                }

                let textToRead = '';
                for (let i = 0; i < Math.min(3, paragraphs.length); i++) {
                    textToRead += paragraphs[i].textContent + ' ';
                }

                if (textToRead.trim().length === 0) {
                    showStatus("Fehler: Kein Text zum Vorlesen gefunden.", true);
                    return;
                }

                currentSpeech = new SpeechSynthesisUtterance(textToRead.trim());
                
                const targetLang = languageTexts[currentLanguage].lang;
                const bestVoice = findBestVoice(targetLang);
                
                if (bestVoice) {
                    currentSpeech.voice = bestVoice;
                    currentSpeech.lang = bestVoice.lang;
                } else {
                    currentSpeech.lang = targetLang;
                    showStatus(languageTexts[currentLanguage].noVoiceMessage, false);
                }

                currentSpeech.rate = 0.8;
                currentSpeech.volume = 1.0;
                currentSpeech.pitch = 1.0;

                currentSpeech.onstart = function() {
                    isReading = true;
                    showStatus(languageTexts[currentLanguage].startMessage);
                };

                currentSpeech.onend = function() {
                    isReading = false;
                    currentSpeech = null;
                    showStatus("Vorlesen beendet. ‚úÖ");
                };

                currentSpeech.onerror = function(event) {
                    isReading = false;
                    currentSpeech = null;
                    console.error('Speech error:', event);
                    showStatus("Fehler beim Vorlesen. Browser-Problem erkannt.", true);
                };

                try {
                    speechSynthesis.speak(currentSpeech);
                    
                    setTimeout(() => {
                        if (currentSpeech && !speechSynthesis.speaking && !speechSynthesis.pending) {
                            showStatus("Vorlesen konnte nicht gestartet werden. Browser-Einschr√§nkung.", true);
                            isReading = false;
                            currentSpeech = null;
                        }
                    }, 2000);
                    
                } catch (error) {
                    console.error('Speech synthesis error:', error);
                    showStatus("Fehler: " + error.message, true);
                    isReading = false;
                    currentSpeech = null;
                }

            } catch (error) {
                console.error('General error:', error);
                showStatus("Unerwarteter Fehler beim Vorlesen.", true);
                isReading = false;
                currentSpeech = null;
            }
        }

        function stopReading() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            
            if (currentSpeech) {
                currentSpeech = null;
            }
            
            if (isReading) {
                isReading = false;
                showStatus(languageTexts[currentLanguage].stopMessage);
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            if (!('speechSynthesis' in window)) {
                console.warn('Text-to-Speech wird von diesem Browser nicht unterst√ºtzt');
                showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                
                const readBtn = document.querySelector('.btn-read');
                readBtn.style.opacity = '0.5';
                readBtn.style.cursor = 'not-allowed';
                readBtn.onclick = function() {
                    showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                };
            } else {
                try {
                    await loadVoices();
                    console.log('Verf√ºgbare Stimmen:', availableVoices.length);
                } catch (error) {
                    console.error('Fehler beim Laden der Stimmen:', error);
                }
            }
        });

        window.addEventListener('beforeunload', function() {
            stopReading();
        });

        document.addEventListener('touchstart', function() {
            if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                const dummySpeech = new SpeechSynthesisUtterance('');
                dummySpeech.volume = 0;
                speechSynthesis.speak(dummySpeech);
            }
        }, { once: true });
    </script>
</body>
</html>
