<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Der Beginn des Friedens - Vorlesen</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d1810 50%, #0f0f23 100%);
            min-height: 100vh;
        }
        
        .rainbow-header {
            height: 20px;
            background: linear-gradient(90deg, 
                #FFD700 0%, 
                #FFA500 14%, 
                #FF8C00 28%, 
                #8B4513 42%, 
                #654321 56%, 
                #4B0000 70%, 
                #2F1B14 84%, 
                #1C1C1C 100%);
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            background: linear-gradient(135deg, #2a2a3a 0%, #1f1f2f 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 3px solid #FFD700;
        }
        
        h1 {
            color: #FFD700;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255,215,0,0.5);
        }
        
        .author {
            text-align: center;
            color: #FFA500;
            font-style: italic;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .controls {
            position: sticky;
            top: 20px;
            text-align: center;
            margin: 30px 0 10px 0;
            padding: 20px;
            background: linear-gradient(135deg, #3a3a4a 0%, #2f2f3f 100%);
            border-radius: 15px;
            border: 2px solid #FFD700;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(255,215,0,0.3);
        }
        
        .language-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-lang {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            border: 2px solid transparent;
        }
        
        .btn-lang.active {
            border-color: #FF8C00;
            box-shadow: 0 0 15px rgba(255, 140, 0, 0.8);
        }
        
        .btn-lang:hover {
            background: linear-gradient(135deg, #FFA500, #FF8C00);
            transform: translateY(-2px);
        }
        
        .btn-nav {
            background: linear-gradient(135deg, #8B4513, #654321);
            color: white;
            text-decoration: none;
            border: 2px solid transparent;
        }
        
        .btn-nav:hover {
            background: linear-gradient(135deg, #654321, #4B0000);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139,69,19,0.4);
        }
        
        .btn-read {
            background: linear-gradient(135deg, #228B22, #006400);
            color: white;
        }
        
        .btn-read:hover {
            background: linear-gradient(135deg, #006400, #004000);
            transform: translateY(-2px);
        }
        
        .btn-stop {
            background: linear-gradient(135deg, #DC143C, #B22222);
            color: white;
        }
        
        .btn-stop:hover {
            background: linear-gradient(135deg, #B22222, #8B0000);
            transform: translateY(-2px);
        }
        
        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #E6E6FA;
            text-align: justify;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #FFD700;
            box-shadow: 0 5px 15px rgba(255,215,0,0.2);
        }
        
        .story-text p {
            margin-bottom: 20px;
        }
        
        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                padding: 15px;
            }
            
            .btn {
                display: block;
                margin: 10px auto;
                width: 200px;
            }
            
            .language-navigation {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="rainbow-header"></div>
    
    <div class="container">
        <h1 id="main-title">Band 2: Der Beginn des Friedens</h1>
        <p class="author" id="author">von Helmut Wegner</p>
        
        <div class="controls">
            <div class="language-navigation">
                <a href="index.html" class="btn btn-nav">üè† Startseite</a>
                <button class="btn btn-lang active" onclick="switchLanguage('de')">üá©üá™ Deutsch</button>
                <button class="btn btn-lang" onclick="switchLanguage('en')">üá¨üáß English</button>
                <a href="high-fantasy.html" class="btn btn-nav">‚öîÔ∏è High Fantasy</a>
            </div>
            
            <div id="status-message" class="status-message" style="display: none;"></div>
            
            <button class="btn btn-read" onclick="startReading()">üîä <span id="btn-read-text">Vorlesen starten</span></button>
            <button class="btn btn-stop" onclick="stopReading()">‚èπÔ∏è <span id="btn-stop-text">Stoppen</span></button>
        </div>
        
        <!-- Deutsche Version -->
        <div id="de-content" class="language-content">
            <div class="story-text" id="storyText">
                <p>Die D√§mmerung tauchte die T√ºrme von Eldoria in warmes Gold, als Eryon und Aris auf den gepflasterten Stra√üen der Stadt einritten. Die Menschen dr√§ngten sich dicht an den Stra√üenr√§ndern, jubelnd und lachend. Fahnen flatterten im Wind, und der s√º√üe Duft von Blumen, die in H√ºlle und F√ºlle auf die Helden herabregneten, vermischte sich mit dem erdigen Aroma des Pflasters. Eryon sa√ü auf einem majest√§tischen Rappen, seine goldene R√ºstung funkelte im Licht. Ein L√§cheln spielte auf seinen Lippen, doch in seinen Augen lag ein Schatten, den die Menge nicht wahrnahm. "Der K√∂nig ist zur√ºck!", schallte ein Ruf durch die Stra√üen, und die Menge antwortete mit einem Chor aus Jubel und Liedern.</p>

                <p>Im Gro√üen Saal, wo die Ratsf√ºhrer der V√∂lker Eldorias versammelt waren, empfing eine k√ºhle, fast greifbare Spannung die Ank√∂mmlinge. Der Elfenf√ºrst, hochgewachsen und mit funkelnden Augen, begr√º√üte Eryon mit knapper H√∂flichkeit. Die Zwerge hingegen, gedrungen und schwer ger√ºstet, grummelten leise vor sich hin. "Unsere Schmiede haben das Beste gegeben, um diese Schlacht zu gewinnen", erkl√§rte ein Zwergen√§ltester, doch seine Stimme klang trotzig. "Und doch habt ihr euch erst zu sp√§t dem Kampf angeschlossen", erwiderte eine Elfe mit scharfer Zunge. Eryon hob die Hand, um Einhalt zu gebieten. "Heute feiern wir den Frieden. Lasst uns nicht den Keim von Zwietracht s√§en, wo Einheit n√∂tig ist."</p>

                <p>W√§hrend der Feierlichkeiten im Palast wandelten Aris' Gedanken in dunkleren Gefilden. Ihr scharfer Blick glitt √ºber die Menge, bis sie an einer verh√ºllten Gestalt h√§ngen blieb, die abseits stand. Der Fremde schien sich kaum zu bewegen, doch als Aris n√§her trat, l√∂ste er sich in der Menge auf. Sp√§ter, als die Feierlichkeiten verstummten, zog sich Eryon in den Thronsaal zur√ºck. "Es f√ºhlt sich nicht wie ein Sieg an", murmelte er. Aris legte ihm eine Hand auf die Schulter. "Der Frieden ist nur ein Anfang, Eryon. Die wahre Pr√ºfung liegt noch vor uns." Tief in den Schatten von Eldorias Bergen versammelten sich w√§hrenddessen d√ºstere Gestalten. "Die Dunkelheit mag geschlagen sein, doch sie ist nicht besiegt", fl√ºsterte eine verh√ºllte Stimme.</p>
            </div>
        </div>
        
        <!-- Englische Version -->
        <div id="en-content" class="language-content hidden">
            <div class="story-text" id="storyTextEn">
                <p>Twilight bathed the towers of Eldoria in warm gold as Eryon and Aris rode into the cobbled streets of the city. People crowded densely along the roadsides, cheering and laughing. Banners fluttered in the wind, and the sweet scent of flowers raining down upon the heroes in abundance mingled with the earthy aroma of the pavement. Eryon sat on a majestic black horse, his golden armor sparkling in the light. A smile played on his lips, yet in his eyes lay a shadow that the crowd did not perceive. "The King has returned!" echoed a cry through the streets, and the crowd responded with a chorus of cheers and songs.</p>

                <p>In the Great Hall, where the council leaders of Eldoria's peoples were assembled, a cool, almost tangible tension greeted the arrivals. The Elf Prince, tall and with sparkling eyes, greeted Eryon with curt politeness. The dwarves, however, stocky and heavily armored, grumbled quietly to themselves. "Our smiths gave their best to win this battle," declared a dwarf elder, yet his voice sounded defiant. "And yet you joined the fight too late," retorted an elf with a sharp tongue. Eryon raised his hand to call for halt. "Today we celebrate peace. Let us not sow the seeds of discord where unity is needed."</p>

                <p>During the festivities in the palace, Aris's thoughts wandered in darker realms. Her sharp gaze swept over the crowd until it lingered on a veiled figure standing apart. The stranger seemed barely to move, yet when Aris approached, he dissolved into the crowd. Later, when the festivities fell silent, Eryon withdrew to the throne room. "It doesn't feel like a victory," he murmured. Aris placed a hand on his shoulder. "Peace is only a beginning, Eryon. The true test still lies before us." Deep in the shadows of Eldoria's mountains, meanwhile, sinister figures gathered. "The darkness may be defeated, but it is not vanquished," whispered a veiled voice.</p>
            </div>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let isReading = false;
        let currentLanguage = 'de';
        let availableVoices = [];

        // Spracheinstellungen
        const languageTexts = {
            de: {
                title: "Band 2: Der Beginn des Friedens",
                author: "von Helmut Wegner",
                btnRead: "Vorlesen starten",
                btnStop: "Stoppen",
                lang: "de-DE",
                startMessage: "Vorlesen gestartet! üîä",
                stopMessage: "Vorlesen gestoppt. ‚èπÔ∏è",
                errorMessage: "Fehler: Vorlesen wird von diesem Browser nicht unterst√ºtzt.",
                noVoiceMessage: "Hinweis: Keine deutsche Stimme verf√ºgbar. Verwende Standardstimme."
            },
            en: {
                title: "Volume 2: The Beginning of Peace",
                author: "by Helmut Wegner",
                btnRead: "Start Reading",
                btnStop: "Stop",
                lang: "en-US",
                startMessage: "Reading started! üîä",
                stopMessage: "Reading stopped. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech not supported by this browser.",
                noVoiceMessage: "Note: No English voice available. Using default voice."
            }
        };

        function loadVoices() {
            return new Promise((resolve) => {
                availableVoices = speechSynthesis.getVoices();
                if (availableVoices.length > 0) {
                    resolve(availableVoices);
                } else {
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, { once: true });
                    setTimeout(() => {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, 1000);
                }
            });
        }

        function findBestVoice(targetLang) {
            if (availableVoices.length === 0) return null;
            let voice = availableVoices.find(v => v.lang === targetLang);
            if (voice) return voice;
            const langFamily = targetLang.split('-')[0];
            voice = availableVoices.find(v => v.lang.startsWith(langFamily));
            if (voice) return voice;
            return availableVoices[0];
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
            statusDiv.style.display = 'block';
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function switchLanguage(lang) {
            // Stoppe aktuelles Vorlesen
            stopReading();
            
            // Verstecke alle Sprachen
            document.querySelectorAll('.language-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Zeige ausgew√§hlte Sprache
            document.getElementById(lang + '-content').classList.remove('hidden');
            
            // Update Sprachbuttons
            document.querySelectorAll('.btn-lang').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update Texte
            currentLanguage = lang;
            const texts = languageTexts[lang];
            document.getElementById('main-title').textContent = texts.title;
            document.getElementById('author').textContent = texts.author;
            document.getElementById('btn-read-text').textContent = texts.btnRead;
            document.getElementById('btn-stop-text').textContent = texts.btnStop;
            
            // Status verstecken
            document.getElementById('status-message').style.display = 'none';
        }

        async function startReading() {
            if (!('speechSynthesis' in window)) {
                showStatus(languageTexts[currentLanguage].errorMessage, true);
                return;
            }

            stopReading();

            try {
                await loadVoices();

                const storyElement = document.querySelector(`#${currentLanguage}-content .story-text`);
                if (!storyElement) {
                    showStatus("Fehler: Text nicht gefunden.", true);
                    return;
                }

                const paragraphs = storyElement.querySelectorAll('p');
                if (paragraphs.length === 0) {
                    showStatus("Fehler: Keine Textabschnitte gefunden.", true);
                    return;
                }

                // NUR ERSTE 3 ABS√ÑTZE (WELTWEIT KOMPATIBEL)
                let textToRead = '';
                for (let i = 0; i < Math.min(3, paragraphs.length); i++) {
                    textToRead += paragraphs[i].textContent + ' ';
                }

                if (textToRead.trim().length === 0) {
                    showStatus("Fehler: Kein Text zum Vorlesen gefunden.", true);
                    return;
                }

                currentSpeech = new SpeechSynthesisUtterance(textToRead.trim());

                const targetLang = languageTexts[currentLanguage].lang;
                const bestVoice = findBestVoice(targetLang);

                if (bestVoice) {
                    currentSpeech.voice = bestVoice;
                    currentSpeech.lang = bestVoice.lang;
                } else {
                    currentSpeech.lang = targetLang;
                    showStatus(languageTexts[currentLanguage].noVoiceMessage, false);
                }

                // OPTIMIERTE EINSTELLUNGEN
                currentSpeech.rate = 0.8;
                currentSpeech.volume = 1.0;
                currentSpeech.pitch = 1.0;

                currentSpeech.onstart = function() {
                    isReading = true;
                    showStatus(languageTexts[currentLanguage].startMessage);
                };

                currentSpeech.onend = function() {
                    isReading = false;
                    currentSpeech = null;
                    showStatus("Vorlesen beendet. ‚úÖ");
                };

                currentSpeech.onerror = function(event) {
                    isReading = false;
                    currentSpeech = null;
                    console.error('Speech error:', event);
                    showStatus("Fehler beim Vorlesen. Browser-Problem erkannt.", true);
                };

                try {
                    speechSynthesis.speak(currentSpeech);
                    setTimeout(() => {
                        if (currentSpeech && !speechSynthesis.speaking && !speechSynthesis.pending) {
                            showStatus("Vorlesen konnte nicht gestartet werden. Browser-Einschr√§nkung.", true);
                            isReading = false;
                            currentSpeech = null;
                        }
                    }, 2000);
                } catch (error) {
                    console.error('Speech synthesis error:', error);
                    showStatus("Fehler: " + error.message, true);
                    isReading = false;
                    currentSpeech = null;
                }

            } catch (error) {
                console.error('General error:', error);
                showStatus("Unerwarteter Fehler beim Vorlesen.", true);
                isReading = false;
                currentSpeech = null;
            }
        }

        function stopReading() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            if (currentSpeech) {
                currentSpeech = null;
            }
            if (isReading) {
                isReading = false;
                showStatus(languageTexts[currentLanguage].stopMessage);
            }
        }

        // BROWSER-KOMPATIBILIT√ÑT PR√úFUNG
        document.addEventListener('DOMContentLoaded', async function() {
            if (!('speechSynthesis' in window)) {
                console.warn('Text-to-Speech wird von diesem Browser nicht unterst√ºtzt');
                showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                const readBtn = document.querySelector('.btn-read');
                readBtn.style.opacity = '0.5';
                readBtn.style.cursor = 'not-allowed';
                readBtn.onclick = function() {
                    showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                };
            } else {
                try {
                    await loadVoices();
                    console.log('Verf√ºgbare Stimmen:', availableVoices.length);
                } catch (error) {
                    console.error('Fehler beim Laden der Stimmen:', error);
                }
            }
        });

        // CLEANUP
        window.addEventListener('beforeunload', function() {
            stopReading();
        });

        // MOBILE SAFARI FIX
        document.addEventListener('touchstart', function() {
            if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                const dummySpeech = new SpeechSynthesisUtterance('');
                dummySpeech.volume = 0;
                speechSynthesis.speak(dummySpeech);
            }
        }, { once: true });
    </script>
</body>
</html>
