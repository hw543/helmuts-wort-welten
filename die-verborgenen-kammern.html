<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hinter verschlossenen T√ºren - Vorlesen</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #FFE5E5 0%, #FFB6C1 50%, #FF69B4 100%);
            min-height: 100vh;
        }
        
        .rainbow-header {
            height: 20px;
            background: linear-gradient(90deg, 
                #FF0000 0%, 
                #FF7F00 14%, 
                #FFFF00 28%, 
                #00FF00 42%, 
                #0000FF 56%, 
                #4B0082 70%, 
                #9400D3 84%, 
                #FF1493 100%);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            background: linear-gradient(135deg, #FFF8F0 0%, #FFE4E6 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid #C2185B;
        }
        
        h1 {
            color: #C2185B;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(194,24,91,0.3);
        }
        
        .author {
            text-align: center;
            color: #E91E63;
            font-style: italic;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .controls {
            position: sticky;
            top: 20px;
            text-align: center;
            margin: 30px 0 10px 0;
            padding: 20px;
            background: linear-gradient(135deg, #FFE4E1 0%, #FFF0F5 100%);
            border-radius: 15px;
            border: 2px solid #FFB6C1;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(255,182,193,0.3);
        }
        
        .language-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-lang {
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            color: white;
            border: 2px solid transparent;
        }
        
        .btn-lang.active {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }
        
        .btn-lang:hover {
            background: linear-gradient(135deg, #FF1493, #C71585);
            transform: translateY(-2px);
        }
        
        .btn-nav {
            background: linear-gradient(135deg, #9370DB, #8A2BE2);
            color: white;
            text-decoration: none;
            border: 2px solid transparent;
        }
        
        .btn-nav:hover {
            background: linear-gradient(135deg, #8A2BE2, #7B68EE);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(138,43,226,0.4);
        }
        
        .btn-read {
            background: linear-gradient(135deg, #32CD32, #228B22);
            color: white;
        }
        
        .btn-read:hover {
            background: linear-gradient(135deg, #228B22, #006400);
            transform: translateY(-2px);
        }
        
        .btn-stop {
            background: linear-gradient(135deg, #FF6347, #FF4500);
            color: white;
        }
        
        .btn-stop:hover {
            background: linear-gradient(135deg, #FF4500, #FF2400);
            transform: translateY(-2px);
        }
        
        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #2F4F4F;
            text-align: justify;
            background: linear-gradient(135deg, #FFFAF0 0%, #FFF8DC 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #DDA0DD;
            box-shadow: 0 5px 15px rgba(221,160,221,0.2);
        }
        
        .story-text p {
            margin-bottom: 20px;
        }
        
        .hidden {
            display: none;
        }
        
        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                padding: 15px;
            }
            
            .btn {
                display: block;
                margin: 10px auto;
                width: 200px;
            }
            
            .language-navigation {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="rainbow-header"></div>
    
    <div class="container">
        <h1 id="main-title">Hinter verschlossenen T√ºren</h1>
        <p class="author" id="author">von Helmut Wegner</p>
        
        <div class="controls">
            <div class="language-navigation">
                <a href="index.html" class="btn btn-nav">üè† Startseite</a>
                <button class="btn btn-lang active" onclick="switchLanguage('de')">üá©üá™ Deutsch</button>
                <button class="btn btn-lang" onclick="switchLanguage('en')">üá¨üáß English</button>
                <button class="btn btn-lang" onclick="switchLanguage('es')">üá™üá∏ Espa√±ol</button>
                <a href="die-verborgenen-kammern.html" class="btn btn-nav">‚Üê Zur√ºck zur Serie</a>
            </div>
            
            <div id="status-message" class="status-message" style="display: none;"></div>
            
            <button class="btn btn-read" onclick="startReading()">üîä <span id="btn-read-text">Vorlesen starten</span></button>
            <button class="btn btn-stop" onclick="stopReading()">‚èπÔ∏è <span id="btn-stop-text">Stoppen</span></button>
        </div>
        
        <!-- Deutsche Version -->
        <div id="de-content" class="language-content">
            <div class="story-text" id="storyText">
                <p>Elena Winters stand vor dem imposanten Geb√§ude in der Berliner Friedrichstra√üe und sp√ºrte, wie ihr Herz schneller schlug. Die schweren Glast√ºren der Galerie ‚ÄûCastellano Fine Arts" reflektierten das warme Licht der Nachmittagssonne. Als Restauratorin hatte sie schon viele bedeutende Kunstwerke gesehen, doch dieser Auftrag war anders. Besonders.</p>

                <p>Sie dr√ºckte die T√ºrklinke hinunter und betrat den eleganten Empfangsbereich. Sofort umh√ºllte sie der Duft von kostbarem Holz und dem leichten Aroma edler Parfums. Die W√§nde waren mit exquisiten Gem√§lden geschm√ºckt, jedes ein Meisterwerk f√ºr sich. ‚ÄûGuten Tag, Sie m√ºssen Elena Winters sein", begr√º√üte sie eine elegante Frau mit silbergrauen Haaren. ‚ÄûHerr Castellano erwartet Sie bereits."</p>

                <p>Elena folgte der Assistentin durch einen langen Korridor, vorbei an weiteren Kunstwerken, die stumme Zeugen vergangener Epochen waren. Ihre Abs√§tze klackten rhythmisch auf dem Marmorboden, ein Ger√§usch, das in der ehrw√ºrdigen Stille der Galerie besonders laut zu sein schien. Am Ende des Korridors √∂ffnete sich eine schwere Mahagonit√ºr, und Elena trat in das private B√ºro des Galeriebesitzers.</p>
            </div>
        </div>
        
        <!-- English Version -->
        <div id="en-content" class="language-content hidden">
            <div class="story-text" id="storyTextEn">
                <p>Elena Winters stood before the imposing building on Berlin's Friedrichstra√üe and felt her heart beating faster. The heavy glass doors of the "Castellano Fine Arts" gallery reflected the warm light of the afternoon sun. As a restorer, she had seen many significant artworks, but this assignment was different. Special.</p>

                <p>She pressed down the door handle and entered the elegant reception area. Immediately, she was enveloped by the scent of precious wood and the light aroma of fine perfumes. The walls were decorated with exquisite paintings, each a masterpiece in itself. "Good day, you must be Elena Winters," greeted an elegant woman with silver-gray hair. "Mr. Castellano is already expecting you."</p>

                <p>Elena followed the assistant through a long corridor, past more artworks that were silent witnesses to past eras. Her heels clicked rhythmically on the marble floor, a sound that seemed particularly loud in the reverent silence of the gallery. At the end of the corridor, a heavy mahogany door opened, and Elena stepped into the gallery owner's private office.</p>
            </div>
        </div>
        
        <!-- Spanish Version -->
        <div id="es-content" class="language-content hidden">
            <div class="story-text" id="storyTextEs">
                <p>Elena Winters se encontraba frente al imponente edificio en la Friedrichstra√üe de Berl√≠n y sinti√≥ c√≥mo su coraz√≥n lat√≠a m√°s r√°pido. Las pesadas puertas de cristal de la galer√≠a "Castellano Fine Arts" reflejaban la c√°lida luz del sol de la tarde. Como restauradora, hab√≠a visto muchas obras de arte importantes, pero este encargo era diferente. Especial.</p>

                <p>Presion√≥ la manija de la puerta y entr√≥ en la elegante √°rea de recepci√≥n. Inmediatamente la envolvi√≥ el aroma de madera preciosa y el ligero aroma de perfumes finos. Las paredes estaban decoradas con pinturas exquisitas, cada una una obra maestra por s√≠ misma. "Buenas tardes, usted debe ser Elena Winters", la salud√≥ una mujer elegante de cabello gris plateado. "El se√±or Castellano ya la est√° esperando."</p>

                <p>Elena sigui√≥ a la asistente a trav√©s de un largo corredor, pasando por m√°s obras de arte que eran testigos silenciosos de √©pocas pasadas. Sus tacones resonaban r√≠tmicamente en el suelo de m√°rmol, un sonido que parec√≠a particularmente fuerte en el silencio reverente de la galer√≠a. Al final del corredor se abri√≥ una pesada puerta de caoba, y Elena entr√≥ en la oficina privada del propietario de la galer√≠a.</p>
            </div>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let isReading = false;
        let currentLanguage = 'de';
        let availableVoices = [];

        // Spracheinstellungen
        const languageTexts = {
            de: {
                title: "Hinter verschlossenen T√ºren",
                author: "von Helmut Wegner",
                btnRead: "Vorlesen starten",
                btnStop: "Stoppen",
                lang: "de-DE",
                startMessage: "Vorlesen gestartet! üîä",
                stopMessage: "Vorlesen gestoppt. ‚èπÔ∏è",
                errorMessage: "Fehler: Vorlesen wird von diesem Browser nicht unterst√ºtzt.",
                noVoiceMessage: "Hinweis: Keine deutsche Stimme verf√ºgbar. Verwende Standardstimme."
            },
            en: {
                title: "Behind Closed Doors",
                author: "by Helmut Wegner",
                btnRead: "Start Reading",
                btnStop: "Stop",
                lang: "en-US",
                startMessage: "Reading started! üîä",
                stopMessage: "Reading stopped. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech not supported by this browser.",
                noVoiceMessage: "Note: No English voice available. Using default voice."
            },
            es: {
                title: "Detr√°s de Puertas Cerradas",
                author: "por Helmut Wegner",
                btnRead: "Comenzar Lectura",
                btnStop: "Detener",
                lang: "es-ES",
                startMessage: "¬°Lectura iniciada! üîä",
                stopMessage: "Lectura detenida. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech no es compatible con este navegador.",
                noVoiceMessage: "Nota: No hay voz en espa√±ol disponible. Usando voz predeterminada."
            }
        };

        function loadVoices() {
            return new Promise((resolve) => {
                availableVoices = speechSynthesis.getVoices();
                
                if (availableVoices.length > 0) {
                    resolve(availableVoices);
                } else {
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, { once: true });
                    
                    setTimeout(() => {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, 1000);
                }
            });
        }

        function findBestVoice(targetLang) {
            if (availableVoices.length === 0) {
                return null;
            }

            let voice = availableVoices.find(v => v.lang === targetLang);
            if (voice) return voice;

            const langFamily = targetLang.split('-')[0];
            voice = availableVoices.find(v => v.lang.startsWith(langFamily));
            if (voice) return voice;

            return availableVoices[0];
        }

        function switchLanguage(lang) {
            stopReading();
            
            document.querySelectorAll('.language-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(lang + '-content').classList.remove('hidden');
            
            document.querySelectorAll('.btn-lang').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentLanguage = lang;
            const texts = languageTexts[lang];
            document.getElementById('main-title').textContent = texts.title;
            document.getElementById('author').textContent = texts.author;
            document.getElementById('btn-read-text').textContent = texts.btnRead;
            document.getElementById('btn-stop-text').textContent = texts.btnStop;
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
            statusDiv.style.display = 'block';
            
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        async function startReading() {
            if (!('speechSynthesis' in window)) {
                showStatus(languageTexts[currentLanguage].errorMessage, true);
                return;
            }

            stopReading();

            try {
                await loadVoices();

                const storyElement = document.querySelector(`#${currentLanguage}-content .story-text`);
                if (!storyElement) {
                    showStatus("Fehler: Text nicht gefunden.", true);
                    return;
                }

                const paragraphs = storyElement.querySelectorAll('p');
                if (paragraphs.length === 0) {
                    showStatus("Fehler: Keine Textabschnitte gefunden.", true);
                    return;
                }

                let textToRead = '';
                for (let i = 0; i < Math.min(3, paragraphs.length); i++) {
                    textToRead += paragraphs[i].textContent + ' ';
                }

                if (textToRead.trim().length === 0) {
                    showStatus("Fehler: Kein Text zum Vorlesen gefunden.", true);
                    return;
                }

                currentSpeech = new SpeechSynthesisUtterance(textToRead.trim());
                
                const targetLang = languageTexts[currentLanguage].lang;
                const bestVoice = findBestVoice(targetLang);
                
                if (bestVoice) {
                    currentSpeech.voice = bestVoice;
                    currentSpeech.lang = bestVoice.lang;
                } else {
                    currentSpeech.lang = targetLang;
                    showStatus(languageTexts[currentLanguage].noVoiceMessage, false);
                }

                currentSpeech.rate = 0.8;
                currentSpeech.volume = 1.0;
                currentSpeech.pitch = 1.0;

                currentSpeech.onstart = function() {
                    isReading = true;
                    showStatus(languageTexts[currentLanguage].startMessage);
                };

                currentSpeech.onend = function() {
                    isReading = false;
                    currentSpeech = null;
                    showStatus("Vorlesen beendet. ‚úÖ");
                };

                currentSpeech.onerror = function(event) {
                    isReading = false;
                    currentSpeech = null;
                    console.error('Speech error:', event);
                    showStatus("Fehler beim Vorlesen. Browser-Problem erkannt.", true);
                };

                try {
                    speechSynthesis.speak(currentSpeech);
                    
                    setTimeout(() => {
                        if (currentSpeech && !speechSynthesis.speaking && !speechSynthesis.pending) {
                            showStatus("Vorlesen konnte nicht gestartet werden. Browser-Einschr√§nkung.", true);
                            isReading = false;
                            currentSpeech = null;
                        }
                    }, 2000);
                    
                } catch (error) {
                    console.error('Speech synthesis error:', error);
                    showStatus("Fehler: " + error.message, true);
                    isReading = false;
                    currentSpeech = null;
                }

            } catch (error) {
                console.error('General error:', error);
                showStatus("Unerwarteter Fehler beim Vorlesen.", true);
                isReading = false;
                currentSpeech = null;
            }
        }

        function stopReading() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            
            if (currentSpeech) {
                currentSpeech = null;
            }
            
            if (isReading) {
                isReading = false;
                showStatus(languageTexts[currentLanguage].stopMessage);
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            if (!('speechSynthesis' in window)) {
                console.warn('Text-to-Speech wird von diesem Browser nicht unterst√ºtzt');
                showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                
                const readBtn = document.querySelector('.btn-read');
                readBtn.style.opacity = '0.5';
                readBtn.style.cursor = 'not-allowed';
                readBtn.onclick = function() {
                    showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                };
            } else {
                try {
                    await loadVoices();
                    console.log('Verf√ºgbare Stimmen:', availableVoices.length);
                } catch (error) {
                    console.error('Fehler beim Laden der Stimmen:', error);
                }
            }
        });

        window.addEventListener('beforeunload', function() {
            stopReading();
        });

        document.addEventListener('touchstart', function() {
            if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                const dummySpeech = new SpeechSynthesisUtterance('');
                dummySpeech.volume = 0;
                speechSynthesis.speak(dummySpeech);
            }
        }, { once: true });
    </script>
</body>
</html>
