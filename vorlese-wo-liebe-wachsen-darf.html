<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wo Liebe wachsen darf - Vorlesen</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #E6E6FA 0%, #DDA0DD 50%, #FFB6C1 100%);
            min-height: 100vh;
        }
        
        .rainbow-header {
            height: 20px;
            background: linear-gradient(90deg, 
                #9370DB 0%, 
                #8A2BE2 14%, 
                #BA55D3 28%, 
                #DA70D6 42%, 
                #FF69B4 56%, 
                #FFB6C1 70%, 
                #FFC0CB 84%, 
                #E6E6FA 100%);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            background: linear-gradient(135deg, #FFEEF7 0%, #F8F0FF 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid #DDA0DD;
        }
        
        h1 {
            color: #8A2BE2;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(138,43,226,0.3);
        }
        
        .author {
            text-align: center;
            color: #9370DB;
            font-style: italic;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .controls {
            position: sticky;
            top: 20px;
            text-align: center;
            margin: 30px 0 10px 0;
            padding: 20px;
            background: linear-gradient(135deg, #F5E6FF 0%, #FDEEF7 100%);
            border-radius: 15px;
            border: 2px solid #DDA0DD;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(221,160,221,0.3);
        }
        
        .language-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-lang {
            background: linear-gradient(135deg, #BA55D3, #9370DB);
            color: white;
            border: 2px solid transparent;
        }
        
        .btn-lang.active {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }
        
        .btn-lang:hover {
            background: linear-gradient(135deg, #9370DB, #8A2BE2);
            transform: translateY(-2px);
        }
        
        .btn-nav {
            background: linear-gradient(135deg, #9370DB, #8A2BE2);
            color: white;
            text-decoration: none;
            border: 2px solid transparent;
        }
        
        .btn-nav:hover {
            background: linear-gradient(135deg, #8A2BE2, #7B68EE);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(138,43,226,0.4);
        }
        
        .btn-read {
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            color: white;
        }
        
        .btn-read:hover {
            background: linear-gradient(135deg, #FF1493, #C71585);
            transform: translateY(-2px);
        }
        
        .btn-stop {
            background: linear-gradient(135deg, #DC143C, #B22222);
            color: white;
        }
        
        .btn-stop:hover {
            background: linear-gradient(135deg, #B22222, #8B0000);
            transform: translateY(-2px);
        }
        
        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #2F2F2F;
            text-align: justify;
            background: linear-gradient(135deg, #FFFAFD 0%, #FFF8FB 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #DDA0DD;
            box-shadow: 0 5px 15px rgba(221,160,221,0.2);
        }
        
        .story-text p {
            margin-bottom: 20px;
        }
        
        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                padding: 15px;
            }
            
            .btn {
                display: block;
                margin: 10px auto;
                width: 200px;
            }
            
            .language-navigation {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="rainbow-header"></div>
    
    <div class="container">
        <h1 id="main-title">Band 3: Wo Liebe wachsen darf</h1>
        <p class="author" id="author">von Helmut Wegner</p>
        
        <div class="controls">
            <div class="language-navigation">
                <a href="index.html" class="btn btn-nav">üè† Startseite</a>
                <button class="btn btn-lang active" onclick="switchLanguage('de')">üá©üá™ Deutsch</button>
                <button class="btn btn-lang" onclick="switchLanguage('en')">üá¨üáß English</button>
                <a href="romantik-fiktion.html" class="btn btn-nav">üíú New Adult</a>
            </div>
            
            <div id="status-message" class="status-message" style="display: none;"></div>
            
            <button class="btn btn-read" onclick="startReading()">üîä <span id="btn-read-text">Vorlesen starten</span></button>
            <button class="btn btn-stop" onclick="stopReading()">‚èπÔ∏è <span id="btn-stop-text">Stoppen</span></button>
        </div>
        
        <!-- Deutsche Version -->
        <div id="de-content" class="language-content">
            <div class="story-text" id="storyText">
                <p>Lena erinnerte sich an die Momente, in denen sie sich so verbunden gef√ºhlt hatte, als ob die Worte zwischen ihnen eine Br√ºcke gebaut h√§tten, die alle Unsicherheiten √ºberwinden konnte. Aber jetzt war diese Br√ºcke verschwunden, und sie stand wieder am Ufer, unsicher, wie sie den Fluss √ºberqueren sollte. Sie √∂ffnete die Schublade ihres Schreibtisches und nahm den Stapel Briefe heraus, die sie und Julian einander geschrieben hatten. Jeder Brief war ein St√ºck ihrer gemeinsamen Geschichte, ein Beweis daf√ºr, dass sie einmal eine tiefe Verbindung gehabt hatten.</p>

                <p>Sie bl√§tterte durch die Seiten, las hier und da einen Satz, der ihr ins Auge sprang. "Ich habe das Gef√ºhl, als ob wir uns in einer Sprache verstehen, die niemand sonst spricht." "Deine Worte sind wie ein Zuhause f√ºr mich." "Manchmal frage ich mich, ob wir uns jemals wirklich verstehen werden." Diese S√§tze hallten in ihr nach, und sie sp√ºrte einen Stich in der Brust. Warum war es so schwer, diese Verbindung in die reale Welt zu √ºbertragen? Warum f√ºhlte es sich an, als ob sie auf Papier so viel leichter atmen konnten als im echten Leben?</p>

                <p>Sie legte die Briefe zur√ºck in die Schublade und schloss sie. Vielleicht war es an der Zeit, etwas Neues zu beginnen, etwas, das nicht von der Vergangenheit belastet war. Sie ging in die K√ºche und setzte Wasser f√ºr Tee auf. W√§hrend sie darauf wartete, dass das Wasser kochte, dachte sie √ºber ihre Zukunft nach. Sie hatte immer davon getr√§umt, Schriftstellerin zu werden, aber jetzt, wo sie die Chance hatte, f√ºhlte es sich an, als ob etwas fehlte. Vielleicht war es die Gewissheit, dass jemand da war, der an sie glaubte, der sie unterst√ºtzte.</p>
            </div>
        </div>
        
        <!-- Englische Version -->
        <div id="en-content" class="language-content hidden">
            <div class="story-text" id="storyTextEn">
                <p>Lena remembered the moments when she had felt so connected, as if the words between them had built a bridge that could overcome all uncertainties. But now that bridge had disappeared, and she stood again on the shore, uncertain how to cross the river. She opened the drawer of her desk and took out the stack of letters that she and Julian had written to each other. Each letter was a piece of their shared history, proof that they had once had a deep connection.</p>

                <p>She leafed through the pages, reading here and there a sentence that caught her eye. "I have the feeling that we understand each other in a language that no one else speaks." "Your words are like a home to me." "Sometimes I wonder if we will ever really understand each other." These sentences echoed within her, and she felt a stab in her chest. Why was it so hard to transfer this connection to the real world? Why did it feel as if they could breathe so much easier on paper than in real life?</p>

                <p>She put the letters back in the drawer and closed it. Perhaps it was time to begin something new, something that wasn't burdened by the past. She went to the kitchen and put water on for tea. While she waited for the water to boil, she thought about her future. She had always dreamed of becoming a writer, but now that she had the chance, it felt as if something was missing. Perhaps it was the certainty that someone was there who believed in her, who supported her.</p>
            </div>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let isReading = false;
        let currentLanguage = 'de';
        let availableVoices = [];

        // Spracheinstellungen
        const languageTexts = {
            de: {
                title: "Band 3: Wo Liebe wachsen darf",
                author: "von Helmut Wegner",
                btnRead: "Vorlesen starten",
                btnStop: "Stoppen",
                lang: "de-DE",
                startMessage: "Vorlesen gestartet! üîä",
                stopMessage: "Vorlesen gestoppt. ‚èπÔ∏è",
                errorMessage: "Fehler: Vorlesen wird von diesem Browser nicht unterst√ºtzt.",
                noVoiceMessage: "Hinweis: Keine deutsche Stimme verf√ºgbar. Verwende Standardstimme."
            },
            en: {
                title: "Volume 3: Where Love May Grow",
                author: "by Helmut Wegner",
                btnRead: "Start Reading",
                btnStop: "Stop",
                lang: "en-US",
                startMessage: "Reading started! üîä",
                stopMessage: "Reading stopped. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech not supported by this browser.",
                noVoiceMessage: "Note: No English voice available. Using default voice."
            }
        };

        function loadVoices() {
            return new Promise((resolve) => {
                availableVoices = speechSynthesis.getVoices();
                if (availableVoices.length > 0) {
                    resolve(availableVoices);
                } else {
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, { once: true });
                    setTimeout(() => {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, 1000);
                }
            });
        }

        function findBestVoice(targetLang) {
            if (availableVoices.length === 0) return null;
            let voice = availableVoices.find(v => v.lang === targetLang);
            if (voice) return voice;
            const langFamily = targetLang.split('-')[0];
            voice = availableVoices.find(v => v.lang.startsWith(langFamily));
            if (voice) return voice;
            return availableVoices[0];
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
            statusDiv.style.display = 'block';
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function switchLanguage(lang) {
            // Stoppe aktuelles Vorlesen
            stopReading();
            
            // Verstecke alle Sprachen
            document.querySelectorAll('.language-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Zeige ausgew√§hlte Sprache
            document.getElementById(lang + '-content').classList.remove('hidden');
            
            // Update Sprachbuttons
            document.querySelectorAll('.btn-lang').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update Texte
            currentLanguage = lang;
            const texts = languageTexts[lang];
            document.getElementById('main-title').textContent = texts.title;
            document.getElementById('author').textContent = texts.author;
            document.getElementById('btn-read-text').textContent = texts.btnRead;
            document.getElementById('btn-stop-text').textContent = texts.btnStop;
            
            // Status verstecken
            document.getElementById('status-message').style.display = 'none';
        }

        async function startReading() {
            if (!('speechSynthesis' in window)) {
                showStatus(languageTexts[currentLanguage].errorMessage, true);
                return;
            }

            stopReading();

            try {
                await loadVoices();

                const storyElement = document.querySelector(`#${currentLanguage}-content .story-text`);
                if (!storyElement) {
                    showStatus("Fehler: Text nicht gefunden.", true);
                    return;
                }

                const paragraphs = storyElement.querySelectorAll('p');
                if (paragraphs.length === 0) {
                    showStatus("Fehler: Keine Textabschnitte gefunden.", true);
                    return;
                }

                // NUR ERSTE 3 ABS√ÑTZE (WELTWEIT KOMPATIBEL)
                let textToRead = '';
                for (let i = 0; i < Math.min(3, paragraphs.length); i++) {
                    textToRead += paragraphs[i].textContent + ' ';
                }

                if (textToRead.trim().length === 0) {
                    showStatus("Fehler: Kein Text zum Vorlesen gefunden.", true);
                    return;
                }

                currentSpeech = new SpeechSynthesisUtterance(textToRead.trim());

                const targetLang = languageTexts[currentLanguage].lang;
                const bestVoice = findBestVoice(targetLang);

                if (bestVoice) {
                    currentSpeech.voice = bestVoice;
                    currentSpeech.lang = bestVoice.lang;
                } else {
                    currentSpeech.lang = targetLang;
                    showStatus(languageTexts[currentLanguage].noVoiceMessage, false);
                }

                // OPTIMIERTE EINSTELLUNGEN
                currentSpeech.rate = 0.8;
                currentSpeech.volume = 1.0;
                currentSpeech.pitch = 1.0;

                currentSpeech.onstart = function() {
                    isReading = true;
                    showStatus(languageTexts[currentLanguage].startMessage);
                };

                currentSpeech.onend = function() {
                    isReading = false;
                    currentSpeech = null;
                    showStatus("Vorlesen beendet. ‚úÖ");
                };

                currentSpeech.onerror = function(event) {
                    isReading = false;
                    currentSpeech = null;
                    console.error('Speech error:', event);
                    showStatus("Fehler beim Vorlesen. Browser-Problem erkannt.", true);
                };

                try {
                    speechSynthesis.speak(currentSpeech);
                    setTimeout(() => {
                        if (currentSpeech && !speechSynthesis.speaking && !speechSynthesis.pending) {
                            showStatus("Vorlesen konnte nicht gestartet werden. Browser-Einschr√§nkung.", true);
                            isReading = false;
                            currentSpeech = null;
                        }
                    }, 2000);
                } catch (error) {
                    console.error('Speech synthesis error:', error);
                    showStatus("Fehler: " + error.message, true);
                    isReading = false;
                    currentSpeech = null;
                }

            } catch (error) {
                console.error('General error:', error);
                showStatus("Unerwarteter Fehler beim Vorlesen.", true);
                isReading = false;
                currentSpeech = null;
            }
        }

        function stopReading() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            if (currentSpeech) {
                currentSpeech = null;
            }
            if (isReading) {
                isReading = false;
                showStatus(languageTexts[currentLanguage].stopMessage);
            }
        }

        // BROWSER-KOMPATIBILIT√ÑT PR√úFUNG
        document.addEventListener('DOMContentLoaded', async function() {
            if (!('speechSynthesis' in window)) {
                console.warn('Text-to-Speech wird von diesem Browser nicht unterst√ºtzt');
                showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                const readBtn = document.querySelector('.btn-read');
                readBtn.style.opacity = '0.5';
                readBtn.style.cursor = 'not-allowed';
                readBtn.onclick = function() {
                    showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                };
            } else {
                try {
                    await loadVoices();
                    console.log('Verf√ºgbare Stimmen:', availableVoices.length);
                } catch (error) {
                    console.error('Fehler beim Laden der Stimmen:', error);
                }
            }
        });

        // CLEANUP
        window.addEventListener('beforeunload', function() {
            stopReading();
        });

        // MOBILE SAFARI FIX
        document.addEventListener('touchstart', function() {
            if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                const dummySpeech = new SpeechSynthesisUtterance('');
                dummySpeech.volume = 0;
                speechSynthesis.speak(dummySpeech);
            }
        }, { once: true });
    </script>
</body>
</html>
