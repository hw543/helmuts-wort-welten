<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Die Schatten der D√∂rfer - Vorlesen</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f1419 100%);
            min-height: 100vh;
        }
        
        .rainbow-header {
            height: 20px;
            background: linear-gradient(90deg, 
                #2F4F4F 0%, 
                #708090 14%, 
                #696969 28%, 
                #556B2F 42%, 
                #2E8B57 56%, 
                #008080 70%, 
                #191970 84%, 
                #000000 100%);
            box-shadow: 0 3px 10px rgba(47,79,79,0.5);
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            background: linear-gradient(135deg, #1e1e3a 0%, #2a2a4a 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            border: 3px solid #708090;
        }
        
        .book-cover {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .book-cover img {
            max-width: 200px;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.6);
            border: 3px solid #708090;
        }
        
        h1 {
            color: #708090;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(112,128,144,0.7);
        }
        
        .author {
            text-align: center;
            color: #2E8B57;
            font-style: italic;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .controls {
            position: sticky;
            top: 20px;
            text-align: center;
            margin: 30px 0 10px 0;
            padding: 20px;
            background: linear-gradient(135deg, #2F4F4F 0%, #1e1e3a 100%);
            border-radius: 15px;
            border: 2px solid #708090;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(112,128,144,0.4);
        }
        
        .language-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-lang {
            background: linear-gradient(135deg, #708090, #2F4F4F);
            color: white;
            border: 2px solid transparent;
        }
        
        .btn-lang.active {
            border-color: #2E8B57;
            box-shadow: 0 0 15px rgba(46, 139, 87, 0.8);
        }
        
        .btn-lang:hover {
            background: linear-gradient(135deg, #2F4F4F, #556B2F);
            transform: translateY(-2px);
        }
        
        .btn-nav {
            background: linear-gradient(135deg, #556B2F, #2E8B57);
            color: white;
            text-decoration: none;
            border: 2px solid transparent;
        }
        
        .btn-nav:hover {
            background: linear-gradient(135deg, #2E8B57, #008080);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(46,139,87,0.5);
        }
        
        .btn-read {
            background: linear-gradient(135deg, #228B22, #006400);
            color: white;
        }
        
        .btn-read:hover {
            background: linear-gradient(135deg, #006400, #004000);
            transform: translateY(-2px);
        }
        
        .btn-stop {
            background: linear-gradient(135deg, #DC143C, #B22222);
            color: white;
        }
        
        .btn-stop:hover {
            background: linear-gradient(135deg, #B22222, #8B0000);
            transform: translateY(-2px);
        }
        
        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #F5F5DC;
            text-align: justify;
            background: linear-gradient(135deg, #0f1419 0%, #1a1a2e 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #708090;
            box-shadow: 0 5px 15px rgba(112,128,144,0.3);
        }
        
        .story-text p {
            margin-bottom: 20px;
        }
        
        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            .book-cover img {
                max-width: 150px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                padding: 15px;
            }
            
            .btn {
                display: block;
                margin: 10px auto;
                width: 200px;
            }
            
            .language-navigation {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="rainbow-header"></div>
    
    <div class="container">
        <div class="book-cover">
            <img src="die-schatten-der-doerfer.jpg" alt="Die Schatten der D√∂rfer - Cover" />
        </div>
        
        <h1 id="main-title">Band 3: Die Schatten der D√∂rfer</h1>
        <p class="author" id="author">von Helmut Wegner</p>
        
        <div class="controls">
            <div class="language-navigation">
                <a href="index.html" class="btn btn-nav">üè† Startseite</a>
                <button class="btn btn-lang active" onclick="switchLanguage('de')">üá©üá™ Deutsch</button>
                <button class="btn btn-lang" onclick="switchLanguage('en')">üá¨üáß English</button>
                <a href="krimis.html" class="btn btn-nav">üïµÔ∏è Krimis</a>
            </div>
            
            <div id="status-message" class="status-message" style="display: none;"></div>
            
            <button class="btn btn-read" onclick="startReading()">üîä <span id="btn-read-text">Vorlesen starten</span></button>
            <button class="btn btn-stop" onclick="stopReading()">‚èπÔ∏è <span id="btn-stop-text">Stoppen</span></button>
        </div>
        
        <!-- Deutsche Version -->
        <div id="de-content" class="language-content">
            <div class="story-text" id="storyText">
                <p>Die ersten Sonnenstrahlen schlichen sich √ºber die sanften H√ºgel des kleinen Dorfes, das in der D√§mmerung wie ein kostbares Geheimnis lag. Die Luft war frisch und rein, und ein sanfter Nebel schwebte √ºber den Wiesen, w√§hrend die V√∂gel ihr morgendliches Konzert anstimmten. Das Dorf selbst war ein Bild der Idylle, mit seinen kleinen, liebevoll gepflegten H√§usern, die sich entlang der schmalen, gepflasterten Stra√üen reihten. Unter den Neuen war Erik, ein junger Mann, der in j√ºngster Vergangenheit in das Dorf gezogen war. Mit einem Koffer in der Hand und einer Mischung aus Nervosit√§t und Aufregung im Herzen machte er seine ersten Schritte √ºber den Dorfplatz.</p>

                <p>Sein optimistischer Start in den Tag wurde j√§h unterbrochen, als Erik auf den Platz trat und etwas Ungew√∂hnliches erblickte. Die Gruppe der Dorfbewohner hatte sich um das historische Denkmal versammelt, das stolz in der Mitte des Platzes stand. Ein steinerner Engel, der seit Generationen √ºber das Dorf wachte, wurde mit Graffiti bespr√ºht. Die farbenfrohen Buchstaben stachen extrem gegen das blasse Steinrelief hervor und waren eine Verletzung der alten Traditionen. Erik n√§herte sich der Menge, die in gespannten, besorgten Diskussionen vertieft war. Entsetzen spiegelte sich in den Gesichtern der Dorfbewohner wider.</p>

                <p>Im Laufe des Vormittags versammelten sich die Dorfbewohner im Gasthaus, um √ºber den Vorfall zu diskutieren. Erik setzte sich in eine Ecke und h√∂rte aufmerksam zu. "Wir k√∂nnen das nicht einfach ignorieren! Wir m√ºssen sofort handeln!" rief eine Frau, deren Augen wild funkelten. Ger√ºchte √ºber Nachbarn und selbst √ºber die Zuwanderer begannen die Runde zu machen, und Erik f√ºhlte, wie die Spannungen in der Luft kaum ertragbar wurden. Erik lauschte den pers√∂nlichen Anekdoten und beobachtete, wie sich die Gemeinschaft um den Vorfall gruppierte. Er sp√ºrte eine merkw√ºrdige Zerrissenheit: Einerseits wollte er dazugeh√∂ren, andererseits war er der Neuling, der erst noch lernen musste, wie diese Dorfgemeinschaft funktionierte.</p>
            </div>
        </div>
        
        <!-- Englische Version -->
        <div id="en-content" class="language-content hidden">
            <div class="story-text" id="storyTextEn">
                <p>The first rays of sun crept over the gentle hills of the small village, which lay like a precious secret in the dawn. The air was fresh and pure, and a gentle mist hovered over the meadows while the birds struck up their morning concert. The village itself was a picture of idyll, with its small, lovingly tended houses that lined the narrow, cobbled streets. Among the newcomers was Erik, a young man who had recently moved to the village. With a suitcase in hand and a mixture of nervousness and excitement in his heart, he took his first steps across the village square.</p>

                <p>His optimistic start to the day was abruptly interrupted when Erik stepped onto the square and saw something unusual. The group of villagers had gathered around the historic monument that stood proudly in the center of the square. A stone angel that had watched over the village for generations had been spray-painted with graffiti. The colorful letters stood out extremely against the pale stone relief and were a violation of old traditions. Erik approached the crowd, which was absorbed in tense, worried discussions. Horror was reflected in the faces of the villagers.</p>

                <p>During the morning, the villagers gathered in the inn to discuss the incident. Erik sat in a corner and listened attentively. "We can't just ignore this! We must act immediately!" cried a woman whose eyes sparkled wildly. Rumors about neighbors and even about the immigrants began to circulate, and Erik felt how the tensions in the air became almost unbearable. Erik listened to the personal anecdotes and observed how the community grouped around the incident. He felt a strange conflict: on one hand he wanted to belong, on the other hand he was the newcomer who still had to learn how this village community functioned.</p>
            </div>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let isReading = false;
        let currentLanguage = 'de';
        let availableVoices = [];

        const languageTexts = {
            de: {
                title: "Band 3: Die Schatten der D√∂rfer",
                author: "von Helmut Wegner",
                btnRead: "Vorlesen starten",
                btnStop: "Stoppen",
                lang: "de-DE",
                startMessage: "Vorlesen gestartet! üîä",
                stopMessage: "Vorlesen gestoppt. ‚èπÔ∏è",
                errorMessage: "Fehler: Vorlesen wird von diesem Browser nicht unterst√ºtzt.",
                noVoiceMessage: "Hinweis: Keine deutsche Stimme verf√ºgbar. Verwende Standardstimme."
            },
            en: {
                title: "Volume 3: The Shadows of the Villages",
                author: "by Helmut Wegner",
                btnRead: "Start Reading",
                btnStop: "Stop",
                lang: "en-US",
                startMessage: "Reading started! üîä",
                stopMessage: "Reading stopped. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech not supported by this browser.",
                noVoiceMessage: "Note: No English voice available. Using default voice."
            }
        };

        function loadVoices() {
            return new Promise((resolve) => {
                availableVoices = speechSynthesis.getVoices();
                if (availableVoices.length > 0) {
                    resolve(availableVoices);
                } else {
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, { once: true });
                    setTimeout(() => {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, 1000);
                }
            });
        }

        function findBestVoice(targetLang) {
            if (availableVoices.length === 0) return null;
            let voice = availableVoices.find(v => v.lang === targetLang);
            if (voice) return voice;
            const langFamily = targetLang.split('-')[0];
            voice = availableVoices.find(v => v.lang.startsWith(langFamily));
            if (voice) return voice;
            return availableVoices[0];
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
            statusDiv.style.display = 'block';
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function switchLanguage(lang) {
            stopReading();
            
            document.querySelectorAll('.language-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            document.getElementById(lang + '-content').classList.remove('hidden');
            
            document.querySelectorAll('.btn-lang').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            currentLanguage = lang;
            const texts = languageTexts[lang];
            document.getElementById('main-title').textContent = texts.title;
            document.getElementById('author').textContent = texts.author;
            document.getElementById('btn-read-text').textContent = texts.btnRead;
            document.getElementById('btn-stop-text').textContent = texts.btnStop;
            
            document.getElementById('status-message').style.display = 'none';
        }

        async function startReading() {
            if (!('speechSynthesis' in window)) {
                showStatus(languageTexts[currentLanguage].errorMessage, true);
                return;
            }

            stopReading();

            try {
                await loadVoices();

                const storyElement = document.querySelector(`#${currentLanguage}-content .story-text`);
                if (!storyElement) {
                    showStatus("Fehler: Text nicht gefunden.", true);
                    return;
                }

                const paragraphs = storyElement.querySelectorAll('p');
                if (paragraphs.length === 0) {
                    showStatus("Fehler: Keine Textabschnitte gefunden.", true);
                    return;
                }

                let textToRead = '';
                for (let i = 0; i < Math.min(3, paragraphs.length); i++) {
                    textToRead += paragraphs[i].textContent + ' ';
                }

                if (textToRead.trim().length === 0) {
                    showStatus("Fehler: Kein Text zum Vorlesen gefunden.", true);
                    return;
                }

                currentSpeech = new SpeechSynthesisUtterance(textToRead.trim());

                const targetLang = languageTexts[currentLanguage].lang;
                const bestVoice = findBestVoice(targetLang);

                if (bestVoice) {
                    currentSpeech.voice = bestVoice;
                    currentSpeech.lang = bestVoice.lang;
                } else {
                    currentSpeech.lang = targetLang;
                    showStatus(languageTexts[currentLanguage].noVoiceMessage, false);
                }

                currentSpeech.rate = 0.8;
                currentSpeech.volume = 1.0;
                currentSpeech.pitch = 1.0;

                currentSpeech.onstart = function() {
                    isReading = true;
                    showStatus(languageTexts[currentLanguage].startMessage);
                };

                currentSpeech.onend = function() {
                    isReading = false;
                    currentSpeech = null;
                    showStatus("Vorlesen beendet. ‚úÖ");
                };

                currentSpeech.onerror = function(event) {
                    isReading = false;
                    currentSpeech = null;
                    console.error('Speech error:', event);
                    showStatus("Fehler beim Vorlesen. Browser-Problem erkannt.", true);
                };

                try {
                    speechSynthesis.speak(currentSpeech);
                    setTimeout(() => {
                        if (currentSpeech && !speechSynthesis.speaking && !speechSynthesis.pending) {
                            showStatus("Vorlesen konnte nicht gestartet werden. Browser-Einschr√§nkung.", true);
                            isReading = false;
                            currentSpeech = null;
                        }
                    }, 2000);
                } catch (error) {
                    console.error('Speech synthesis error:', error);
                    showStatus("Fehler: " + error.message, true);
                    isReading = false;
                    currentSpeech = null;
                }

            } catch (error) {
                console.error('General error:', error);
                showStatus("Unerwarteter Fehler beim Vorlesen.", true);
                isReading = false;
                currentSpeech = null;
            }
        }

        function stopReading() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            if (currentSpeech) {
                currentSpeech = null;
            }
            if (isReading) {
                isReading = false;
                showStatus(languageTexts[currentLanguage].stopMessage);
            }
        }

        document.addEventListener('DOMContentLoaded', async function() {
            if (!('speechSynthesis' in window)) {
                console.warn('Text-to-Speech wird von diesem Browser nicht unterst√ºtzt');
                showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                const readBtn = document.querySelector('.btn-read');
                readBtn.style.opacity = '0.5';
                readBtn.style.cursor = 'not-allowed';
                readBtn.onclick = function() {
                    showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                };
            } else {
                try {
                    await loadVoices();
                    console.log('Verf√ºgbare Stimmen:', availableVoices.length);
                } catch (error) {
                    console.error('Fehler beim Laden der Stimmen:', error);
                }
            }
        });

        window.addEventListener('beforeunload', function() {
            stopReading();
        });

        document.addEventListener('touchstart', function() {
            if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                const dummySpeech = new SpeechSynthesisUtterance('');
                dummySpeech.volume = 0;
                speechSynthesis.speak(dummySpeech);
            }
        }, { once: true });
    </script>
</body>
</html>
