<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flammen des Verrats - Vorlesen</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a0e0e 50%, #2d1515 100%);
            min-height: 100vh;
        }
        
        .rainbow-header {
            height: 20px;
            background: linear-gradient(90deg, 
                #FF4500 0%, 
                #FF6347 14%, 
                #DC143C 28%, 
                #B22222 42%, 
                #8B0000 56%, 
                #4B0000 70%, 
                #2F1B14 84%, 
                #000000 100%);
            box-shadow: 0 3px 10px rgba(255,69,0,0.5);
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1515 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.7);
            border: 3px solid #FF4500;
        }
        
        h1 {
            color: #FF4500;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255,69,0,0.7);
        }
        
        .author {
            text-align: center;
            color: #FF6347;
            font-style: italic;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .controls {
            position: sticky;
            top: 20px;
            text-align: center;
            margin: 30px 0 10px 0;
            padding: 20px;
            background: linear-gradient(135deg, #2a1515 0%, #1f1010 100%);
            border-radius: 15px;
            border: 2px solid #FF4500;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(255,69,0,0.4);
        }
        
        .language-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-lang {
            background: linear-gradient(135deg, #FF4500, #DC143C);
            color: white;
            border: 2px solid transparent;
        }
        
        .btn-lang.active {
            border-color: #FF6347;
            box-shadow: 0 0 15px rgba(255, 99, 71, 0.8);
        }
        
        .btn-lang:hover {
            background: linear-gradient(135deg, #DC143C, #B22222);
            transform: translateY(-2px);
        }
        
        .btn-nav {
            background: linear-gradient(135deg, #8B0000, #4B0000);
            color: white;
            text-decoration: none;
            border: 2px solid transparent;
        }
        
        .btn-nav:hover {
            background: linear-gradient(135deg, #4B0000, #2F1B14);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139,0,0,0.5);
        }
        
        .btn-read {
            background: linear-gradient(135deg, #228B22, #006400);
            color: white;
        }
        
        .btn-read:hover {
            background: linear-gradient(135deg, #006400, #004000);
            transform: translateY(-2px);
        }
        
        .btn-stop {
            background: linear-gradient(135deg, #DC143C, #B22222);
            color: white;
        }
        
        .btn-stop:hover {
            background: linear-gradient(135deg, #B22222, #8B0000);
            transform: translateY(-2px);
        }
        
        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #F5F5DC;
            text-align: justify;
            background: linear-gradient(135deg, #0f0f0f 0%, #1a0e0e 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #FF4500;
            box-shadow: 0 5px 15px rgba(255,69,0,0.3);
        }
        
        .story-text p {
            margin-bottom: 20px;
        }
        
        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                padding: 15px;
            }
            
            .btn {
                display: block;
                margin: 10px auto;
                width: 200px;
            }
            
            .language-navigation {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="rainbow-header"></div>
    
    <div class="container">
        <h1 id="main-title">Flammen des Verrats</h1>
        <p class="author" id="author">von Helmut Wegner</p>
        
        <div class="controls">
            <div class="language-navigation">
                <a href="index.html" class="btn btn-nav">üè† Startseite</a>
                <button class="btn btn-lang active" onclick="switchLanguage('de')">üá©üá™ Deutsch</button>
                <button class="btn btn-lang" onclick="switchLanguage('en')">üá¨üáß English</button>
                <a href="thriller.html" class="btn btn-nav">üî• Thriller</a>
            </div>
            
            <div id="status-message" class="status-message" style="display: none;"></div>
            
            <button class="btn btn-read" onclick="startReading()">üîä <span id="btn-read-text">Vorlesen starten</span></button>
            <button class="btn btn-stop" onclick="stopReading()">‚èπÔ∏è <span id="btn-stop-text">Stoppen</span></button>
        </div>
        
        <!-- Deutsche Version -->
        <div id="de-content" class="language-content">
            <div class="story-text" id="storyText">
                <p>Lukas stand da, unsicher, mit einem Anflug von Nervosit√§t, w√§hrend die Flammen vor seinem inneren Auge in scharfer Erinnerung aufflackerten. Seit seiner Kindheit hatte das Feuer eine seltsame Faszination auf ihn ausge√ºbt - eine m√§chtige, alles verzehrende Kraft, die ihn zugleich anzog und einsch√ºchterte. Als er zum ersten Mal die Feuerwache betrat, versp√ºrte er den k√ºhlen Betonboden unter seinen neuen Stiefeln und atmete den charakteristischen Geruch von Rauch, Metall und Motor√∂l ein, der ihm fast wie ein Versprechen vorkam. Hier geh√∂rte er hin, dachte Lukas. Ein neuer Anfang.</p>

                <p>Die ersten Tage vergingen schnell. Lukas lernte, wie man die schwere Ausr√ºstung bedient, und absolvierte schwei√ütreibende √úbungen. Doch in stillen Momenten sp√ºrte Lukas, wie die Flamme seiner inneren Leidenschaft wieder aufflammte. Das Feuer lie√ü ihn nicht los; es zog ihn wie einen stillen Ruf in seinen Bann. Mit jedem Einsatz, bei dem die Flammen zur√ºckgedr√§ngt wurden, sp√ºrte Lukas eine ambivalente Mischung aus Stolz und Entt√§uschung. Stolz, weil er Teil der Feuerwehr war, doch auch Entt√§uschung, weil das Feuer stets nur von au√üen auf ihn wirkte, w√§hrend es tief in ihm auf eine Art pulsierte, die niemand verstand.</p>

                <p>Eines Nachts entdeckte er an einer verlassenen H√ºtte am Stadtrand einen schwelenden Glut-Rest. Er konnte sich kaum dazu zwingen, den Ort zu verlassen. Es war, als w√ºrde ein unsichtbares Band ihn an die Glut fesseln, ihm ins Ohr fl√ºstern und ihn auffordern, sich dem Feuer ganz hinzugeben. Ein Gedanke keimte in ihm auf, so scheu und verstohlen wie eine Flamme, die sich unter einem Aschenhaufen verbarg. Was w√§re, wenn er selbst einen Brand entfachen k√∂nnte? Er erschrak vor dem Gedanken, doch er war da, wie eine kleine Flamme, die langsam, aber best√§ndig an Kraft gewann. Die Vorstellung lie√ü ihn nicht los - sie schlich sich in seine Gedanken zur√ºck und flackerte wie ein lodernder Funke in der Dunkelheit seines Verstands.</p>
            </div>
        </div>
        
        <!-- Englische Version -->
        <div id="en-content" class="language-content hidden">
            <div class="story-text" id="storyTextEn">
                <p>Lukas stood there, uncertain, with a hint of nervousness, while the flames flickered sharply in his mind's eye. Since childhood, fire had exerted a strange fascination on him - a mighty, all-consuming force that both attracted and intimidated him. When he first entered the fire station, he felt the cool concrete floor beneath his new boots and breathed in the characteristic smell of smoke, metal, and motor oil, which seemed almost like a promise to him. This was where he belonged, Lukas thought. A new beginning.</p>

                <p>The first days passed quickly. Lukas learned how to operate the heavy equipment and completed grueling exercises. But in quiet moments, Lukas felt the flame of his inner passion reignite. The fire would not let him go; it drew him like a silent call into its spell. With every deployment where flames were pushed back, Lukas felt an ambivalent mixture of pride and disappointment. Pride because he was part of the fire department, yet also disappointment because the fire only affected him from the outside, while it pulsed deep within him in a way that no one understood.</p>

                <p>One night he discovered smoldering embers at an abandoned hut on the outskirts of town. He could barely force himself to leave the place. It was as if an invisible bond tethered him to the embers, whispering in his ear and urging him to surrender completely to the fire. A thought germinated in him, as shy and furtive as a flame hiding beneath a pile of ashes. What if he could kindle a fire himself? He was startled by the thought, yet it was there, like a small flame that slowly but steadily gained strength. The idea wouldn't leave him alone - it crept back into his thoughts and flickered like a blazing spark in the darkness of his mind.</p>
            </div>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let isReading = false;
        let currentLanguage = 'de';
        let availableVoices = [];

        // Spracheinstellungen
        const languageTexts = {
            de: {
                title: "Flammen des Verrats",
                author: "von Helmut Wegner",
                btnRead: "Vorlesen starten",
                btnStop: "Stoppen",
                lang: "de-DE",
                startMessage: "Vorlesen gestartet! üîä",
                stopMessage: "Vorlesen gestoppt. ‚èπÔ∏è",
                errorMessage: "Fehler: Vorlesen wird von diesem Browser nicht unterst√ºtzt.",
                noVoiceMessage: "Hinweis: Keine deutsche Stimme verf√ºgbar. Verwende Standardstimme."
            },
            en: {
                title: "Flames of Betrayal",
                author: "by Helmut Wegner",
                btnRead: "Start Reading",
                btnStop: "Stop",
                lang: "en-US",
                startMessage: "Reading started! üîä",
                stopMessage: "Reading stopped. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech not supported by this browser.",
                noVoiceMessage: "Note: No English voice available. Using default voice."
            }
        };

        function loadVoices() {
            return new Promise((resolve) => {
                availableVoices = speechSynthesis.getVoices();
                if (availableVoices.length > 0) {
                    resolve(availableVoices);
                } else {
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, { once: true });
                    setTimeout(() => {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, 1000);
                }
            });
        }

        function findBestVoice(targetLang) {
            if (availableVoices.length === 0) return null;
            let voice = availableVoices.find(v => v.lang === targetLang);
            if (voice) return voice;
            const langFamily = targetLang.split('-')[0];
            voice = availableVoices.find(v => v.lang.startsWith(langFamily));
            if (voice) return voice;
            return availableVoices[0];
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
            statusDiv.style.display = 'block';
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function switchLanguage(lang) {
            // Stoppe aktuelles Vorlesen
            stopReading();
            
            // Verstecke alle Sprachen
            document.querySelectorAll('.language-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Zeige ausgew√§hlte Sprache
            document.getElementById(lang + '-content').classList.remove('hidden');
            
            // Update Sprachbuttons
            document.querySelectorAll('.btn-lang').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update Texte
            currentLanguage = lang;
            const texts = languageTexts[lang];
            document.getElementById('main-title').textContent = texts.title;
            document.getElementById('author').textContent = texts.author;
            document.getElementById('btn-read-text').textContent = texts.btnRead;
            document.getElementById('btn-stop-text').textContent = texts.btnStop;
            
            // Status verstecken
            document.getElementById('status-message').style.display = 'none';
        }

        async function startReading() {
            if (!('speechSynthesis' in window)) {
                showStatus(languageTexts[currentLanguage].errorMessage, true);
                return;
            }

            stopReading();

            try {
                await loadVoices();

                const storyElement = document.querySelector(`#${currentLanguage}-content .story-text`);
                if (!storyElement) {
                    showStatus("Fehler: Text nicht gefunden.", true);
                    return;
                }

                const paragraphs = storyElement.querySelectorAll('p');
                if (paragraphs.length === 0) {
                    showStatus("Fehler: Keine Textabschnitte gefunden.", true);
                    return;
                }

                // NUR ERSTE 3 ABS√ÑTZE (WELTWEIT KOMPATIBEL)
                let textToRead = '';
                for (let i = 0; i < Math.min(3, paragraphs.length); i++) {
                    textToRead += paragraphs[i].textContent + ' ';
                }

                if (textToRead.trim().length === 0) {
                    showStatus("Fehler: Kein Text zum Vorlesen gefunden.", true);
                    return;
                }

                currentSpeech = new SpeechSynthesisUtterance(textToRead.trim());

                const targetLang = languageTexts[currentLanguage].lang;
                const bestVoice = findBestVoice(targetLang);

                if (bestVoice) {
                    currentSpeech.voice = bestVoice;
                    currentSpeech.lang = bestVoice.lang;
                } else {
                    currentSpeech.lang = targetLang;
                    showStatus(languageTexts[currentLanguage].noVoiceMessage, false);
                }

                // OPTIMIERTE EINSTELLUNGEN
                currentSpeech.rate = 0.8;
                currentSpeech.volume = 1.0;
                currentSpeech.pitch = 1.0;

                currentSpeech.onstart = function() {
                    isReading = true;
                    showStatus(languageTexts[currentLanguage].startMessage);
                };

                currentSpeech.onend = function() {
                    isReading = false;
                    currentSpeech = null;
                    showStatus("Vorlesen beendet. ‚úÖ");
                };

                currentSpeech.onerror = function(event) {
                    isReading = false;
                    currentSpeech = null;
                    console.error('Speech error:', event);
                    showStatus("Fehler beim Vorlesen. Browser-Problem erkannt.", true);
                };

                try {
                    speechSynthesis.speak(currentSpeech);
                    setTimeout(() => {
                        if (currentSpeech && !speechSynthesis.speaking && !speechSynthesis.pending) {
                            showStatus("Vorlesen konnte nicht gestartet werden. Browser-Einschr√§nkung.", true);
                            isReading = false;
                            currentSpeech = null;
                        }
                    }, 2000);
                } catch (error) {
                    console.error('Speech synthesis error:', error);
                    showStatus("Fehler: " + error.message, true);
                    isReading = false;
                    currentSpeech = null;
                }

            } catch (error) {
                console.error('General error:', error);
                showStatus("Unerwarteter Fehler beim Vorlesen.", true);
                isReading = false;
                currentSpeech = null;
            }
        }

        function stopReading() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            if (currentSpeech) {
                currentSpeech = null;
            }
            if (isReading) {
                isReading = false;
                showStatus(languageTexts[currentLanguage].stopMessage);
            }
        }

        // BROWSER-KOMPATIBILIT√ÑT PR√úFUNG
        document.addEventListener('DOMContentLoaded', async function() {
            if (!('speechSynthesis' in window)) {
                console.warn('Text-to-Speech wird von diesem Browser nicht unterst√ºtzt');
                showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                const readBtn = document.querySelector('.btn-read');
                readBtn.style.opacity = '0.5';
                readBtn.style.cursor = 'not-allowed';
                readBtn.onclick = function() {
                    showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                };
            } else {
                try {
                    await loadVoices();
                    console.log('Verf√ºgbare Stimmen:', availableVoices.length);
                } catch (error) {
                    console.error('Fehler beim Laden der Stimmen:', error);
                }
            }
        });

        // CLEANUP
        window.addEventListener('beforeunload', function() {
            stopReading();
        });

        // MOBILE SAFARI FIX
        document.addEventListener('touchstart', function() {
            if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                const dummySpeech = new SpeechSynthesisUtterance('');
                dummySpeech.volume = 0;
                speechSynthesis.speak(dummySpeech);
            }
        }, { once: true });
    </script>
</body>
</html>
