<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Die Schatten des Vergessenen - Vorlesen</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #1e1e2e 0%, #2d1810 50%, #0f0f23 100%);
            min-height: 100vh;
        }
        
        .rainbow-header {
            height: 20px;
            background: linear-gradient(90deg, 
                #FFD700 0%, 
                #FFA500 14%, 
                #FF8C00 28%, 
                #8B4513 42%, 
                #654321 56%, 
                #4B0000 70%, 
                #2F1B14 84%, 
                #1C1C1C 100%);
            box-shadow: 0 3px 10px rgba(0,0,0,0.4);
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            background: linear-gradient(135deg, #2a2a3a 0%, #1f1f2f 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            border: 3px solid #FFD700;
        }
        
        h1 {
            color: #FFD700;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255,215,0,0.5);
        }
        
        .author {
            text-align: center;
            color: #FFA500;
            font-style: italic;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .controls {
            position: sticky;
            top: 20px;
            text-align: center;
            margin: 30px 0 10px 0;
            padding: 20px;
            background: linear-gradient(135deg, #3a3a4a 0%, #2f2f3f 100%);
            border-radius: 15px;
            border: 2px solid #FFD700;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(255,215,0,0.3);
        }
        
        .language-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-lang {
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: #000;
            border: 2px solid transparent;
        }
        
        .btn-lang.active {
            border-color: #FF8C00;
            box-shadow: 0 0 15px rgba(255, 140, 0, 0.8);
        }
        
        .btn-lang:hover {
            background: linear-gradient(135deg, #FFA500, #FF8C00);
            transform: translateY(-2px);
        }
        
        .btn-nav {
            background: linear-gradient(135deg, #8B4513, #654321);
            color: white;
            text-decoration: none;
            border: 2px solid transparent;
        }
        
        .btn-nav:hover {
            background: linear-gradient(135deg, #654321, #4B0000);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(139,69,19,0.4);
        }
        
        .btn-read {
            background: linear-gradient(135deg, #228B22, #006400);
            color: white;
        }
        
        .btn-read:hover {
            background: linear-gradient(135deg, #006400, #004000);
            transform: translateY(-2px);
        }
        
        .btn-stop {
            background: linear-gradient(135deg, #DC143C, #B22222);
            color: white;
        }
        
        .btn-stop:hover {
            background: linear-gradient(135deg, #B22222, #8B0000);
            transform: translateY(-2px);
        }
        
        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #E6E6FA;
            text-align: justify;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #FFD700;
            box-shadow: 0 5px 15px rgba(255,215,0,0.2);
        }
        
        .story-text p {
            margin-bottom: 20px;
        }
        
        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                padding: 15px;
            }
            
            .btn {
                display: block;
                margin: 10px auto;
                width: 200px;
            }
            
            .language-navigation {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="rainbow-header"></div>
    
    <div class="container">
        <h1 id="main-title">Band 3: Die Schatten des Vergessenen</h1>
        <p class="author" id="author">von Helmut Wegner</p>
        
        <div class="controls">
            <div class="language-navigation">
                <a href="index.html" class="btn btn-nav">üè† Startseite</a>
                <button class="btn btn-lang active" onclick="switchLanguage('de')">üá©üá™ Deutsch</button>
                <button class="btn btn-lang" onclick="switchLanguage('en')">üá¨üáß English</button>
                <a href="high-fantasy.html" class="btn btn-nav">‚öîÔ∏è High Fantasy</a>
            </div>
            
            <div id="status-message" class="status-message" style="display: none;"></div>
            
            <button class="btn btn-read" onclick="startReading()">üîä <span id="btn-read-text">Vorlesen starten</span></button>
            <button class="btn btn-stop" onclick="stopReading()">‚èπÔ∏è <span id="btn-stop-text">Stoppen</span></button>
        </div>
        
        <!-- Deutsche Version -->
        <div id="de-content" class="language-content">
            <div class="story-text" id="storyText">
                <p>Die Morgensonne tauchte die weiten Ebenen von Eldoria in ein goldenes Licht, das von den sanften H√ºgeln zur√ºckstrahlte. Kael sa√ü am Rand der Klippe, die √ºber das Tal von Arien ragte, und lie√ü den Blick √ºber die friedliche Landschaft schweifen. Die Narben der vergangenen Kriege schienen endlich zu verblassen - die Felder trugen wieder reiche Ernten, und die St√§dte erbl√ºhten in neuem Glanz. Doch in Kaels Herzen regte sich Unruhe, ein fl√ºchtiges Verlangen nach etwas Gr√∂√üerem, das er selbst nicht benennen konnte. "Du denkst wieder zu viel nach", rief Tessa hinter ihm, ihre Stimme wie ein fr√∂hlicher Glockenklang. Sie balancierte einen Korb voller Karten und Schriftrollen in den H√§nden.</p>

                <p>"Das hier habe ich im Archiv von Eldarion gefunden", erkl√§rte Tessa, ihre Augen vor Aufregung funkelnd. Sie legte die Karten vor sich aus, eine rote Markierung in einer abgelegenen Ecke fiel auf. "Es zeigt die westlichen Grenzen von Eldoria. Oder besser gesagt, das, was wir dar√ºber wissen - n√§mlich fast nichts." Kael runzelte die Stirn. "Das sind die Randlande. Niemand geht dorthin. Die Geschichten, die man sich erz√§hlt..." "Geschichten", unterbrach sie ihn und hielt eine Pergamentrolle mit k√∂niglichem Siegel hoch. "Und doch schickt uns das Reich eine Botschaft. Diese Region ist nicht so verlassen, wie wir dachten." Die Worte auf der Rolle waren knapp: Ein Licht wurde gesichtet, jenseits der Nebelberge. Seine Quelle ist unbekannt, doch seine Macht ist un√ºbersehbar.</p>

                <p>Am dritten Tag ihrer Reise hatten sie die vertrauten W√§lder von Eldoria hinter sich gelassen und die Grenzen der Nebelberge erreicht. Hier war die Luft anders, schwer und voller unheimlicher Stille. Die Pfade wurden schmaler, und der Nebel verdichtete sich, bis sie kaum die Hand vor Augen sehen konnten. "Wir sind fast da", murmelte Tessa. Pl√∂tzlich zerriss ein dumpfes Dr√∂hnen die Stille. Die Erde vibrierte unter ihren F√º√üen, und Kael zog instinktiv sein Schwert. Vor ihnen √∂ffnete sich die dichte Nebelwand und gab den Blick auf ein leuchtendes, pulsierendes Licht frei. Es schien direkt aus dem Boden zu kommen und warf tanzende Schatten an die Felsen. "Das Licht", fl√ºsterte Tessa ehrf√ºrchtig. "Es existiert wirklich." Doch ein donnerndes Knurren brach aus der Dunkelheit, und zwei gl√ºhende Augen fixierten sie.</p>
            </div>
        </div>
        
        <!-- Englische Version -->
        <div id="en-content" class="language-content hidden">
            <div class="story-text" id="storyTextEn">
                <p>The morning sun bathed the vast plains of Eldoria in golden light that reflected from the gentle hills. Kael sat on the edge of the cliff overlooking the valley of Arien, letting his gaze sweep over the peaceful landscape. The scars of past wars seemed finally to be fading - the fields bore rich harvests again, and the cities bloomed in new splendor. Yet in Kael's heart stirred unrest, a fleeting longing for something greater that he could not name himself. "You're thinking too much again," called Tessa behind him, her voice like a cheerful bell. She balanced a basket full of maps and scrolls in her hands.</p>

                <p>"I found this in the archive of Eldarion," explained Tessa, her eyes sparkling with excitement. She spread the maps before her, a red marking in a remote corner catching attention. "It shows the western borders of Eldoria. Or rather, what we know about them - namely almost nothing." Kael frowned. "Those are the borderlands. Nobody goes there. The stories they tell..." "Stories," she interrupted him and held up a parchment scroll with a royal seal. "And yet the realm sends us a message. This region is not as deserted as we thought." The words on the scroll were brief: A light has been sighted, beyond the Misty Mountains. Its source is unknown, yet its power is unmistakable.</p>

                <p>On the third day of their journey they had left the familiar forests of Eldoria behind and reached the borders of the Misty Mountains. Here the air was different, heavy and full of eerie silence. The paths became narrower, and the fog thickened until they could barely see their hands in front of their eyes. "We're almost there," murmured Tessa. Suddenly a dull roar tore through the silence. The earth vibrated under their feet, and Kael instinctively drew his sword. Before them the dense wall of mist opened and revealed a glowing, pulsating light. It seemed to come directly from the ground and cast dancing shadows on the rocks. "The light," whispered Tessa reverently. "It really exists." But a thunderous growl broke from the darkness, and two glowing eyes fixed on them.</p>
            </div>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let isReading = false;
        let currentLanguage = 'de';
        let availableVoices = [];

        // Spracheinstellungen
        const languageTexts = {
            de: {
                title: "Band 3: Die Schatten des Vergessenen",
                author: "von Helmut Wegner",
                btnRead: "Vorlesen starten",
                btnStop: "Stoppen",
                lang: "de-DE",
                startMessage: "Vorlesen gestartet! üîä",
                stopMessage: "Vorlesen gestoppt. ‚èπÔ∏è",
                errorMessage: "Fehler: Vorlesen wird von diesem Browser nicht unterst√ºtzt.",
                noVoiceMessage: "Hinweis: Keine deutsche Stimme verf√ºgbar. Verwende Standardstimme."
            },
            en: {
                title: "Volume 3: The Shadows of the Forgotten",
                author: "by Helmut Wegner",
                btnRead: "Start Reading",
                btnStop: "Stop",
                lang: "en-US",
                startMessage: "Reading started! üîä",
                stopMessage: "Reading stopped. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech not supported by this browser.",
                noVoiceMessage: "Note: No English voice available. Using default voice."
            }
        };

        function loadVoices() {
            return new Promise((resolve) => {
                availableVoices = speechSynthesis.getVoices();
                if (availableVoices.length > 0) {
                    resolve(availableVoices);
                } else {
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, { once: true });
                    setTimeout(() => {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, 1000);
                }
            });
        }

        function findBestVoice(targetLang) {
            if (availableVoices.length === 0) return null;
            let voice = availableVoices.find(v => v.lang === targetLang);
            if (voice) return voice;
            const langFamily = targetLang.split('-')[0];
            voice = availableVoices.find(v => v.lang.startsWith(langFamily));
            if (voice) return voice;
            return availableVoices[0];
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
            statusDiv.style.display = 'block';
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function switchLanguage(lang) {
            // Stoppe aktuelles Vorlesen
            stopReading();
            
            // Verstecke alle Sprachen
            document.querySelectorAll('.language-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Zeige ausgew√§hlte Sprache
            document.getElementById(lang + '-content').classList.remove('hidden');
            
            // Update Sprachbuttons
            document.querySelectorAll('.btn-lang').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update Texte
            currentLanguage = lang;
            const texts = languageTexts[lang];
            document.getElementById('main-title').textContent = texts.title;
            document.getElementById('author').textContent = texts.author;
            document.getElementById('btn-read-text').textContent = texts.btnRead;
            document.getElementById('btn-stop-text').textContent = texts.btnStop;
            
            // Status verstecken
            document.getElementById('status-message').style.display = 'none';
        }

        async function startReading() {
            if (!('speechSynthesis' in window)) {
                showStatus(languageTexts[currentLanguage].errorMessage, true);
                return;
            }

            stopReading();

            try {
                await loadVoices();

                const storyElement = document.querySelector(`#${currentLanguage}-content .story-text`);
                if (!storyElement) {
                    showStatus("Fehler: Text nicht gefunden.", true);
                    return;
                }

                const paragraphs = storyElement.querySelectorAll('p');
                if (paragraphs.length === 0) {
                    showStatus("Fehler: Keine Textabschnitte gefunden.", true);
                    return;
                }

                // NUR ERSTE 3 ABS√ÑTZE (WELTWEIT KOMPATIBEL)
                let textToRead = '';
                for (let i = 0; i < Math.min(3, paragraphs.length); i++) {
                    textToRead += paragraphs[i].textContent + ' ';
                }

                if (textToRead.trim().length === 0) {
                    showStatus("Fehler: Kein Text zum Vorlesen gefunden.", true);
                    return;
                }

                currentSpeech = new SpeechSynthesisUtterance(textToRead.trim());

                const targetLang = languageTexts[currentLanguage].lang;
                const bestVoice = findBestVoice(targetLang);

                if (bestVoice) {
                    currentSpeech.voice = bestVoice;
                    currentSpeech.lang = bestVoice.lang;
                } else {
                    currentSpeech.lang = targetLang;
                    showStatus(languageTexts[currentLanguage].noVoiceMessage, false);
                }

                // OPTIMIERTE EINSTELLUNGEN
                currentSpeech.rate = 0.8;
                currentSpeech.volume = 1.0;
                currentSpeech.pitch = 1.0;

                currentSpeech.onstart = function() {
                    isReading = true;
                    showStatus(languageTexts[currentLanguage].startMessage);
                };

                currentSpeech.onend = function() {
                    isReading = false;
                    currentSpeech = null;
                    showStatus("Vorlesen beendet. ‚úÖ");
                };

                currentSpeech.onerror = function(event) {
                    isReading = false;
                    currentSpeech = null;
                    console.error('Speech error:', event);
                    showStatus("Fehler beim Vorlesen. Browser-Problem erkannt.", true);
                };

                try {
                    speechSynthesis.speak(currentSpeech);
                    setTimeout(() => {
                        if (currentSpeech && !speechSynthesis.speaking && !speechSynthesis.pending) {
                            showStatus("Vorlesen konnte nicht gestartet werden. Browser-Einschr√§nkung.", true);
                            isReading = false;
                            currentSpeech = null;
                        }
                    }, 2000);
                } catch (error) {
                    console.error('Speech synthesis error:', error);
                    showStatus("Fehler: " + error.message, true);
                    isReading = false;
                    currentSpeech = null;
                }

            } catch (error) {
                console.error('General error:', error);
                showStatus("Unerwarteter Fehler beim Vorlesen.", true);
                isReading = false;
                currentSpeech = null;
            }
        }

        function stopReading() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            if (currentSpeech) {
                currentSpeech = null;
            }
            if (isReading) {
                isReading = false;
                showStatus(languageTexts[currentLanguage].stopMessage);
            }
        }

        // BROWSER-KOMPATIBILIT√ÑT PR√úFUNG
        document.addEventListener('DOMContentLoaded', async function() {
            if (!('speechSynthesis' in window)) {
                console.warn('Text-to-Speech wird von diesem Browser nicht unterst√ºtzt');
                showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                const readBtn = document.querySelector('.btn-read');
                readBtn.style.opacity = '0.5';
                readBtn.style.cursor = 'not-allowed';
                readBtn.onclick = function() {
                    showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                };
            } else {
                try {
                    await loadVoices();
                    console.log('Verf√ºgbare Stimmen:', availableVoices.length);
                } catch (error) {
                    console.error('Fehler beim Laden der Stimmen:', error);
                }
            }
        });

        // CLEANUP
        window.addEventListener('beforeunload', function() {
            stopReading();
        });

        // MOBILE SAFARI FIX
        document.addEventListener('touchstart', function() {
            if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                const dummySpeech = new SpeechSynthesisUtterance('');
                dummySpeech.volume = 0;
                speechSynthesis.speak(dummySpeech);
            }
        }, { once: true });
    </script>
</body>
</html>
