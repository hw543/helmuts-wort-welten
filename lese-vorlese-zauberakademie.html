<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Die Zauberakademie von Morgenstern - Vorlesen</title>
    <style>
        body {
            font-family: 'Georgia', serif;
            line-height: 1.8;
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #FFE5B4 0%, #FFB6C1 50%, #98FB98 100%);
            min-height: 100vh;
        }
        
        .rainbow-header {
            height: 20px;
            background: linear-gradient(90deg, 
                #FF0000 0%, 
                #FF7F00 14%, 
                #FFFF00 28%, 
                #00FF00 42%, 
                #0000FF 56%, 
                #4B0082 70%, 
                #9400D3 84%, 
                #FF1493 100%);
            box-shadow: 0 3px 10px rgba(0,0,0,0.2);
        }
        
        .container {
            max-width: 800px;
            margin: 20px auto;
            background: linear-gradient(135deg, #FFF8DC 0%, #F0F8FF 100%);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            border: 3px solid #FFD700;
        }
        
        h1 {
            color: #FF6347;
            text-align: center;
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(255,105,180,0.3);
        }
        
        .author {
            text-align: center;
            color: #9370DB;
            font-style: italic;
            font-size: 1.2em;
            margin-bottom: 30px;
        }
        
        .controls {
            position: sticky;
            top: 20px;
            text-align: center;
            margin: 30px 0 10px 0;
            padding: 20px;
            background: linear-gradient(135deg, #FFE4E1 0%, #E6E6FA 100%);
            border-radius: 15px;
            border: 2px solid #FFB6C1;
            z-index: 1000;
            box-shadow: 0 5px 15px rgba(255,182,193,0.3);
        }
        
        .language-navigation {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
        }
        
        .btn-lang {
            background: linear-gradient(135deg, #FF69B4, #FF1493);
            color: white;
            border: 2px solid transparent;
        }
        
        .btn-lang.active {
            border-color: #FFD700;
            box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);
        }
        
        .btn-lang:hover {
            background: linear-gradient(135deg, #FF1493, #C71585);
            transform: translateY(-2px);
        }
        
        .btn-nav {
            background: linear-gradient(135deg, #9370DB, #8A2BE2);
            color: white;
            text-decoration: none;
            border: 2px solid transparent;
        }
        
        .btn-nav:hover {
            background: linear-gradient(135deg, #8A2BE2, #7B68EE);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(138,43,226,0.4);
        }
        
        .btn-read {
            background: linear-gradient(135deg, #32CD32, #228B22);
            color: white;
        }
        
        .btn-read:hover {
            background: linear-gradient(135deg, #228B22, #006400);
            transform: translateY(-2px);
        }
        
        .btn-stop {
            background: linear-gradient(135deg, #FF6347, #FF4500);
            color: white;
        }
        
        .btn-stop:hover {
            background: linear-gradient(135deg, #FF4500, #FF2400);
            transform: translateY(-2px);
        }
        
        .story-text {
            font-size: 1.1em;
            line-height: 1.8;
            color: #2F4F4F;
            text-align: justify;
            background: linear-gradient(135deg, #FFFAF0 0%, #FFF8DC 100%);
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #DDA0DD;
            box-shadow: 0 5px 15px rgba(221,160,221,0.2);
        }
        
        .story-text p {
            margin-bottom: 20px;
        }
        
        .status-message {
            text-align: center;
            margin: 10px 0;
            padding: 10px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .status-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 20px;
                margin: 10px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .controls {
                padding: 15px;
            }
            
            .btn {
                display: block;
                margin: 10px auto;
                width: 200px;
            }
            
            .language-navigation {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="rainbow-header"></div>
    
    <div class="container">
        <h1 id="main-title">Die Zauberakademie von Morgenstern</h1>
        <p class="author" id="author">von Helmut Wegner</p>
        
        <div class="controls">
            <div class="language-navigation">
                <a href="index.html" class="btn btn-nav">üè† Startseite</a>
                <button class="btn btn-lang active" onclick="switchLanguage('de')">üá©üá™ Deutsch</button>
                <button class="btn btn-lang" onclick="switchLanguage('en')">üá¨üáß English</button>
                <a href="kinderbuecher.html" class="btn btn-nav">üìö Kinderb√ºcher</a>
            </div>
            
            <div id="status-message" class="status-message" style="display: none;"></div>
            
            <button class="btn btn-read" onclick="startReading()">üîä <span id="btn-read-text">Vorlesen starten</span></button>
            <button class="btn btn-stop" onclick="stopReading()">‚èπÔ∏è <span id="btn-stop-text">Stoppen</span></button>
        </div>
        
        <!-- Deutsche Version -->
        <div id="de-content" class="language-content">
            <div class="story-text" id="storyText">
                <p>Die Morgenluft war k√ºhl und klar, als Leonas Gr√ºnfeld seinen Schulranzen √ºber die Schulter schwang und den staubigen Weg zur Schule einschlug. Der Pfad schl√§ngelte sich zwischen alten Eichen hindurch, deren √Ñste sich wie sch√ºtzende Arme √ºber ihm verwoben und Schatten auf den ausgetretenen Weg warfen. Sein Dorf, eingebettet in weite Felder und dichte W√§lder, erwachte langsam zum Leben. Die Morgensonne malte goldene Streifen √ºber die Wiesen, auf denen der Tau wie tausend kleine Diamanten funkelte.</p>

                <p>K√ºhe muhten leise in der Ferne, ihre Stimmen mischten sich mit dem Gezwitscher der V√∂gel, die ihre Morgenliedchen sangen. Die ersten warmen Sonnenstrahlen brachen durch die Baumwipfel und lie√üen die Bl√§tter in allen Gr√ºnt√∂nen leuchten. F√ºr andere mochte es ein gew√∂hnlicher Tag sein, aber Leonas sp√ºrte eine ungew√∂hnliche Anspannung in der Luft, ein seltsames Kribbeln, das √ºber seine Haut wanderte und ihn innerlich unruhig machte.</p>

                <p>Leonas war ein sch√ºchterner Junge von zw√∂lf Jahren mit strohblonden Haaren, die ihm st√§ndig in die Stirn fielen, und gr√ºnen Augen, die oft nachdenklich und ein wenig melancholisch in die Ferne blickten. Seine Haut war blass, da er die meiste Zeit im Schatten der B√§ume verbrachte, und seine H√§nde waren immer ein wenig schmutzig von der Erde, in der er gerne grub, um K√§fer und W√ºrmer zu beobachten.</p>

                <p>Er mied die lauten Kinder in seiner Klasse und zog es vor, Zeit mit den Tieren des Waldes zu verbringen, die ihn nie verspotteten oder ausschlossen. Seine Schritte waren leise und bedacht, als w√ºrde er versuchen, so unsichtbar wie m√∂glich zu bleiben, w√§hrend er durch die Welt wandelte. Er bewegte sich oft wie ein Schatten, geschmeidig und unbemerkt, eine Eigenschaft, die er sich √ºber Jahre des Vermeidens und Versteckens angeeignet hatte.</p>

                <p>Die anderen Kinder in der Schule verstanden ihn nicht, und er verstand sie genauso wenig. W√§hrend sie sich f√ºr Ballspiele und laute Scherze begeisterten, f√ºr die neuesten Spielzeuge und Trends, fand Leonas Trost in der stillen Beobachtung von K√§fern, die √ºber die raue Baumrinde krochen, oder V√∂geln, die geschickt ihre Nester aus Zweigen und Moos bauten.</p>

                <p>Oft wurde er deshalb verspottet, besonders von Jasper und seiner Clique, einer Gruppe von f√ºnf Jungen, die sich f√ºr die K√∂nige des Schulhofs hielten. Sie nannten sich selbst "die Falken" und trugen diesen Namen mit einem Stolz, der v√∂llig unangebracht war. Jasper war ihr Anf√ºhrer, ein gro√üer, kr√§ftiger Junge mit sch√ºtterem braunen Haar und kleinen, stechenden Augen, die immer nach Schw√§che suchten.</p>

                <p>Heute war keine Ausnahme. Als Leonas die Schule erreichte, das alte Backsteingeb√§ude mit seinen hohen, schmalen Fenstern und dem verwitterten Schieferdach, war es nur eine Frage von Minuten, bevor sie ihn umringten. "Hey, Gr√ºnfeld! Hast du wieder mit deinen Eichh√∂rnchen geplaudert?", fragte Jasper mit einem breiten Grinsen und stie√ü Leonas an die Schulter.</p>

                <p>Die anderen Kinder lachten, w√§hrend Leonas stumm blieb und den Boden betrachtete. Seine H√§nde umklammerten den Riemen seines Ranzens, und er w√ºnschte sich nichts sehnlicher, als unsichtbar zu werden. Die Worte schmerzten mehr, als er zeigen wollte, denn sie trafen genau das, was ihn von den anderen unterschied - seine tiefe Liebe zur Natur und seine merkw√ºrdige F√§higkeit, sich in der Gegenwart von Tieren wohler zu f√ºhlen als bei Menschen.</p>

                <p>Der Unterricht zog sich endlos hin wie ein tr√§ger Fluss an einem hei√üen Sommertag. Leonas sa√ü in der letzten Reihe, seinem gewohnten Platz, von wo aus er sowohl die Tafel sehen als auch unbemerkt aus dem Fenster blicken konnte. Seine Gedanken wanderten unwillk√ºrlich zu den Eichh√∂rnchen, die er gestern beim Sammeln von N√ºssen beobachtet hatte.</p>

                <p>"Leonas!", rief Frau M√ºller scharf. "Kannst du mir die Antwort auf die Frage geben?" Leonas schreckte auf und blickte verwirrt zur Tafel. Er hatte keine Ahnung, worum es ging. Die anderen Kinder kicherten, und er sp√ºrte wieder dieses vertraute Brennen in den Wangen. "Ich... ich wei√ü es nicht", murmelte er. "Dann solltest du besser aufpassen, anstatt zu tr√§umen", ermahnte ihn die Lehrerin mit einem missbilligenden Blick.</p>

                <p>Nach einem langen Tag voller peinlicher Momente und schiefer Blicke eilte Leonas nach Hause. Der kleine Hof seiner Familie, umgeben von dichten Hecken aus Wei√üdorn und Holunder und bl√ºhenden Wildblumen, die seine Mutter liebevoll pflegte, bot ihm zumindest etwas Geborgenheit. Seine Mutter bemerkte seine niedergeschlagene Stimmung. "War es wieder schlimm heute?", fragte sie sanft und strich ihm √ºber das Haar. Leonas nickte nur.</p>

                <p>Er verbrachte den Nachmittag wie gewohnt in seinem Lieblingsversteck, einer kleinen Lichtung im Wald, wo ein alter Baum mit knorrigen Wurzeln stand. Es war sein Zufluchtsort, sein Heiligtum, der einzige Ort auf der Welt, wo er sich vollkommen zu Hause f√ºhlte. Der alte Baum war gewaltig und ehrfurchtgebietend, sein Stamm so dick, dass drei Erwachsene ihn nicht h√§tten umfassen k√∂nnen.</p>
            </div>
        </div>
        
        <!-- Englische Version -->
        <div id="en-content" class="language-content hidden">
            <div class="story-text" id="storyTextEn">
                <p>The morning air was cool and clear as Leonas Gr√ºnfeld slung his school bag over his shoulder and set off on the dusty path to school. The trail wound between old oak trees, whose branches wove together like protective arms above him, casting shadows on the worn path. His village, nestled in wide fields and dense forests, was slowly awakening to life. The morning sun painted golden stripes across the meadows, where dew sparkled like thousands of tiny diamonds.</p>

                <p>Cows lowed softly in the distance, their voices mixing with the chirping of birds singing their morning songs. The first warm rays of sunlight broke through the treetops, making the leaves glow in every shade of green. For others, it might have been an ordinary day, but Leonas sensed an unusual tension in the air, a strange tingling that wandered over his skin and made him feel restless inside.</p>

                <p>Leonas was a shy boy of twelve with straw-blonde hair that constantly fell into his forehead, and green eyes that often gazed thoughtfully and somewhat melancholically into the distance. His skin was pale, as he spent most of his time in the shade of trees, and his hands were always a little dirty from the earth he liked to dig in to observe beetles and worms.</p>

                <p>He avoided the loud children in his class and preferred to spend time with the animals of the forest, who never mocked or excluded him. His steps were quiet and careful, as if he were trying to remain as invisible as possible while wandering through the world. He often moved like a shadow, smooth and unnoticed, a trait he had acquired over years of avoiding and hiding.</p>

                <p>The other children at school didn't understand him, and he understood them just as little. While they were enthusiastic about ball games and loud jokes, about the latest toys and trends, Leonas found comfort in the quiet observation of beetles crawling over rough tree bark, or birds skillfully building their nests from twigs and moss.</p>

                <p>He was often mocked for this, especially by Jasper and his clique, a group of five boys who considered themselves the kings of the schoolyard. They called themselves "the Falcons" and wore this name with a pride that was completely inappropriate. Jasper was their leader, a tall, strong boy with thin brown hair and small, piercing eyes that always searched for weakness.</p>

                <p>Today was no exception. When Leonas reached the school, the old brick building with its high, narrow windows and weathered slate roof, it was only a matter of minutes before they surrounded him. "Hey, Gr√ºnfeld! Have you been chatting with your squirrels again?" asked Jasper with a broad grin, pushing Leonas on the shoulder.</p>

                <p>The other children laughed while Leonas remained silent and stared at the ground. His hands gripped the strap of his bag, and he wished for nothing more than to become invisible. The words hurt more than he wanted to show, because they hit exactly what set him apart from the others - his deep love for nature and his strange ability to feel more comfortable in the presence of animals than with humans.</p>

                <p>The lesson dragged on endlessly like a sluggish river on a hot summer day. Leonas sat in the back row, his usual place, from where he could both see the blackboard and look out the window unnoticed. His thoughts wandered involuntarily to the squirrels he had watched collecting nuts yesterday.</p>

                <p>"Leonas!" called Mrs. M√ºller sharply. "Can you give me the answer to the question?" Leonas startled and looked confused at the blackboard. He had no idea what it was about. The other children giggled, and he felt that familiar burning in his cheeks again. "I... I don't know," he mumbled. "Then you should pay better attention instead of daydreaming," the teacher scolded him with a disapproving look.</p>

                <p>After a long day full of embarrassing moments and sideways glances, Leonas hurried home. His family's small yard, surrounded by dense hedges of hawthorn and elderberry and blooming wildflowers that his mother lovingly tended, offered him at least some comfort. His mother noticed his dejected mood. "Was it bad again today?" she asked gently, stroking his hair. Leonas just nodded.</p>

                <p>He spent the afternoon as usual in his favorite hiding place, a small clearing in the forest where an old tree with gnarled roots stood. It was his refuge, his sanctuary, the only place in the world where he felt completely at home. The old tree was massive and awe-inspiring, its trunk so thick that three adults couldn't have embraced it.</p>
            </div>
        </div>
    </div>

    <script>
        let currentSpeech = null;
        let isReading = false;
        let currentLanguage = 'de';
        let availableVoices = [];

        // Spracheinstellungen
        const languageTexts = {
            de: {
                title: "Die Zauberakademie von Morgenstern",
                author: "von Helmut Wegner",
                btnRead: "Vorlesen starten",
                btnStop: "Stoppen",
                lang: "de-DE",
                startMessage: "Vorlesen gestartet! üîä",
                stopMessage: "Vorlesen gestoppt. ‚èπÔ∏è",
                errorMessage: "Fehler: Vorlesen wird von diesem Browser nicht unterst√ºtzt.",
                noVoiceMessage: "Hinweis: Keine deutsche Stimme verf√ºgbar. Verwende Standardstimme."
            },
            en: {
                title: "The Magic Academy of Morgenstern",
                author: "by Helmut Wegner",
                btnRead: "Start Reading",
                btnStop: "Stop",
                lang: "en-US",
                startMessage: "Reading started! üîä",
                stopMessage: "Reading stopped. ‚èπÔ∏è",
                errorMessage: "Error: Text-to-speech not supported by this browser.",
                noVoiceMessage: "Note: No English voice available. Using default voice."
            }
        };

        function loadVoices() {
            return new Promise((resolve) => {
                availableVoices = speechSynthesis.getVoices();
                if (availableVoices.length > 0) {
                    resolve(availableVoices);
                } else {
                    speechSynthesis.addEventListener('voiceschanged', function() {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, { once: true });
                    setTimeout(() => {
                        availableVoices = speechSynthesis.getVoices();
                        resolve(availableVoices);
                    }, 1000);
                }
            });
        }

        function findBestVoice(targetLang) {
            if (availableVoices.length === 0) return null;
            let voice = availableVoices.find(v => v.lang === targetLang);
            if (voice) return voice;
            const langFamily = targetLang.split('-')[0];
            voice = availableVoices.find(v => v.lang.startsWith(langFamily));
            if (voice) return voice;
            return availableVoices[0];
        }

        function showStatus(message, isError = false) {
            const statusDiv = document.getElementById('status-message');
            statusDiv.textContent = message;
            statusDiv.className = `status-message ${isError ? 'status-error' : 'status-success'}`;
            statusDiv.style.display = 'block';
            setTimeout(() => {
                statusDiv.style.display = 'none';
            }, 5000);
        }

        function switchLanguage(lang) {
            // Stoppe aktuelles Vorlesen
            stopReading();
            
            // Verstecke alle Sprachen
            document.querySelectorAll('.language-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Zeige ausgew√§hlte Sprache
            document.getElementById(lang + '-content').classList.remove('hidden');
            
            // Update Sprachbuttons
            document.querySelectorAll('.btn-lang').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Update Texte
            currentLanguage = lang;
            const texts = languageTexts[lang];
            document.getElementById('main-title').textContent = texts.title;
            document.getElementById('author').textContent = texts.author;
            document.getElementById('btn-read-text').textContent = texts.btnRead;
            document.getElementById('btn-stop-text').textContent = texts.btnStop;
            
            // Status verstecken
            document.getElementById('status-message').style.display = 'none';
        }

        async function startReading() {
            if (!('speechSynthesis' in window)) {
                showStatus(languageTexts[currentLanguage].errorMessage, true);
                return;
            }

            stopReading();

            try {
                await loadVoices();

                const storyElement = document.querySelector(`#${currentLanguage}-content .story-text`);
                if (!storyElement) {
                    showStatus("Fehler: Text nicht gefunden.", true);
                    return;
                }

                const paragraphs = storyElement.querySelectorAll('p');
                if (paragraphs.length === 0) {
                    showStatus("Fehler: Keine Textabschnitte gefunden.", true);
                    return;
                }

                // NUR ERSTE 3 ABS√ÑTZE (WELTWEIT KOMPATIBEL)
                let textToRead = '';
                for (let i = 0; i < Math.min(3, paragraphs.length); i++) {
                    textToRead += paragraphs[i].textContent + ' ';
                }

                if (textToRead.trim().length === 0) {
                    showStatus("Fehler: Kein Text zum Vorlesen gefunden.", true);
                    return;
                }

                currentSpeech = new SpeechSynthesisUtterance(textToRead.trim());

                const targetLang = languageTexts[currentLanguage].lang;
                const bestVoice = findBestVoice(targetLang);

                if (bestVoice) {
                    currentSpeech.voice = bestVoice;
                    currentSpeech.lang = bestVoice.lang;
                } else {
                    currentSpeech.lang = targetLang;
                    showStatus(languageTexts[currentLanguage].noVoiceMessage, false);
                }

                // OPTIMIERTE EINSTELLUNGEN
                currentSpeech.rate = 0.8;
                currentSpeech.volume = 1.0;
                currentSpeech.pitch = 1.0;

                currentSpeech.onstart = function() {
                    isReading = true;
                    showStatus(languageTexts[currentLanguage].startMessage);
                };

                currentSpeech.onend = function() {
                    isReading = false;
                    currentSpeech = null;
                    showStatus("Vorlesen beendet. ‚úÖ");
                };

                currentSpeech.onerror = function(event) {
                    isReading = false;
                    currentSpeech = null;
                    console.error('Speech error:', event);
                    showStatus("Fehler beim Vorlesen. Browser-Problem erkannt.", true);
                };

                try {
                    speechSynthesis.speak(currentSpeech);
                    setTimeout(() => {
                        if (currentSpeech && !speechSynthesis.speaking && !speechSynthesis.pending) {
                            showStatus("Vorlesen konnte nicht gestartet werden. Browser-Einschr√§nkung.", true);
                            isReading = false;
                            currentSpeech = null;
                        }
                    }, 2000);
                } catch (error) {
                    console.error('Speech synthesis error:', error);
                    showStatus("Fehler: " + error.message, true);
                    isReading = false;
                    currentSpeech = null;
                }

            } catch (error) {
                console.error('General error:', error);
                showStatus("Unerwarteter Fehler beim Vorlesen.", true);
                isReading = false;
                currentSpeech = null;
            }
        }

        function stopReading() {
            if (speechSynthesis.speaking || speechSynthesis.pending) {
                speechSynthesis.cancel();
            }
            if (currentSpeech) {
                currentSpeech = null;
            }
            if (isReading) {
                isReading = false;
                showStatus(languageTexts[currentLanguage].stopMessage);
            }
        }

        // BROWSER-KOMPATIBILIT√ÑT PR√úFUNG
        document.addEventListener('DOMContentLoaded', async function() {
            if (!('speechSynthesis' in window)) {
                console.warn('Text-to-Speech wird von diesem Browser nicht unterst√ºtzt');
                showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                const readBtn = document.querySelector('.btn-read');
                readBtn.style.opacity = '0.5';
                readBtn.style.cursor = 'not-allowed';
                readBtn.onclick = function() {
                    showStatus("Vorlesen wird von diesem Browser nicht unterst√ºtzt.", true);
                };
            } else {
                try {
                    await loadVoices();
                    console.log('Verf√ºgbare Stimmen:', availableVoices.length);
                } catch (error) {
                    console.error('Fehler beim Laden der Stimmen:', error);
                }
            }
        });

        // CLEANUP
        window.addEventListener('beforeunload', function() {
            stopReading();
        });

        // MOBILE SAFARI FIX
        document.addEventListener('touchstart', function() {
            if (!speechSynthesis.speaking && !speechSynthesis.pending) {
                const dummySpeech = new SpeechSynthesisUtterance('');
                dummySpeech.volume = 0;
                speechSynthesis.speak(dummySpeech);
            }
        }, { once: true });
    </script>
</body>
</html>
